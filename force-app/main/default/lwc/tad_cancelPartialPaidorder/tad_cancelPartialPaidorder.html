<template>
    <template lwc:if ={showExpirePartial}>
    <div class="title slds-align_absolute-center"><h2>Expire Partial Paid TAD Order</h2></div>
    <template lwc:if ={showSpinner}>
        <div class="spinner">
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        </div>
    </template>
    <div class="row1">
        <span class="p-rec" style="width: 11vw;">Payment Received</span>
        <div class="recAmount">
            <span class="AUD">AUD</span>
            <div class="input">
                <label style="margin-left: 5px;">Received Amount</label>
                <lightning-input type="number" step="0.01" variant ="label-hidden" label="Received Amount" value ={recievedAmount} disabled></lightning-input>
            </div>
        </div>
        <div class="coupon">
            <span class="AUD">AUD</span>
            <div class="input">
                <label style="margin-left: 5px;">Coupon</label>
            <lightning-input type="number" variant ="label-hidden" step="0.01" label="Coupon" value ={couponAmount} disabled></lightning-input>
            </div>
        </div>
    </div>
    <div class="row2">
        <span class="p-rec" style="width: 11vw;">Cancellation Amount</span>
        <div class="recAmount">
            <span class="AUD">AUD</span>
            <div class="input">
                <label style="margin-left: 5px;">Refund Amount</label>
            <lightning-input class = 'input1' type="number" variant ="label-hidden" step="0.01" label="Refund Amount" name="refund" onchange ={inputChangeHandler} required></lightning-input>
            </div>
        </div>
        <div class="coupon">
            <span class="AUD">AUD</span>
            <div class="input">
                <label style="margin-left: 5px;">Coupon</label>
            <lightning-input class = 'input2' type="number" variant ="label-hidden" label="Coupon" step="0.01" name="coupon"  onchange ={inputChangeHandler} required></lightning-input>
            </div>
        </div>
    </div>
    <div class="buttons slds-align_absolute-center" style="margin-top: 4rem">
        <lightning-button variant="brand" label="Submit" title="Submit" name="submit" onclick={handleSaveAndCancel} class="slds-m-left_x-small"></lightning-button>
        <lightning-button variant="neutral" label="Back" title="Back" name="back" onclick={handleSaveAndCancel} class="slds-m-left_x-small"></lightning-button>
    </div>
</template>
<template lwc:elseif={showRefundNoCan}>
    <div class="title slds-align_absolute-center"><h2>Refund No Cancellation</h2></div>
    <template lwc:if ={showSpinner}>
        <div class="spinner">
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        </div>
    </template>
    <div class="slds-box" style="z-index: 2; position:relative">
    <table class="slds-table slds-table_bordered slds-table_col-bordered slds-table_fixed-layout" role="grid">
        <thead class="header">
            <tr class="slds-line-height_reset slds-text-heading_small">
                <th scope="col" width="20%" class="slds-text-align_center"><b>Reason</b></th>
                <th scope="col" width="15%" class="slds-text-align_center"><b>Refund Amount</b></th>
                <th scope="col" width="15%" class="slds-text-align_center"><b>Coupon Amount</b></th>
            </tr>            
        </thead> 
        <tbody class="body">
            <tr>
                <td><lightning-combobox
                    name="reason"
                    value=""
                    placeholder="Select Reason"
                    options={reasonOptions}
                    variant="label-hidden"
                    onchange={handleReasonChange}
            ></lightning-combobox></td>
                <td><lightning-input class = 'input1' type="number" formatter="currency" variant ="label-hidden" step="0.01" label="Refund Amount" name="refund" onchange ={inputChangeHandler}></lightning-input>
                </td>
                <td><lightning-input class = 'input2' type="number" formatter="currency" variant ="label-hidden" label="Coupon" step="0.01" name="coupon" onchange ={inputChangeHandler}></lightning-input>
                </td>
            </tr>
        </tbody>
        </table>
    </div>
    <div class="buttons slds-align_absolute-center" style="margin-top: 4rem">
        <lightning-button variant="brand" label="Submit" title="Submit" name="submit" onclick={handleSaveAndCancel} class="slds-m-left_x-small"></lightning-button>
        <lightning-button variant="neutral" label="Back" title="Back" name="back" onclick={handleSaveAndCancel} class="slds-m-left_x-small"></lightning-button>
    </div>
    <template lwc:if={showSubmittedRequests}>
    <div class="slds-box slds-m-top_small" style="z-index: 1; position:relative">
        <div class="slds-text-heading_medium slds-text-align--center"><b>Submitted/Rejected Cancellations</b></div>
        <br></br>
        <table class="slds-table slds-table_bordered slds-table_col-bordered slds-table_fixed-layout slds-table_resizable-cols" role="grid">
            <thead class="header">
                <tr class="slds-line-height_reset slds-text-heading_small">
                    <th scope="col" width="3%"></th>
                    <th scope="col" width="12%" class="slds-text-align_center"><b>Name</b></th>
                    <th scope="col" width="14%" class="slds-text-align_center"><b>Reason</b></th>
                    <th scope="col" width="14%" class="slds-text-align_center"><b>Type</b></th>
                    <th scope="col" width="14%" class="slds-text-align_center"><b>Refund Amount</b></th>
                    <th scope="col" width="14%" class="slds-text-align_center"><b>Coupon Amount</b></th>
                    <th scope="col" width="12%" class="slds-text-align_center"><b>Approval Stage</b></th>
                </tr>            
            </thead> 
            <tbody class="body">
                <template for:each={approvalHistory} for:item="request" for:index ="index">
                    <tr key = {request.Id} class="slds-theme_shade">
                    <td scope="row" class="slds-text-align--center"><lightning-input type="checkbox" variant ="label-hidden" data-index={index} onchange={checkboxchangeHandler}></lightning-input></td>
                    <td scope="row"><p class="slds-text-align--center">{request.name}</p></td>
                    <td><lightning-combobox class="slds-m-top_xx-small"
                        name="reason1"
                        value={request.refundReason}
                        placeholder="Select Reason"
                        options={reasonOptions}
                        variant="label-hidden"
                        onchange={handleresubmitReasonChange}
                        data-index={index}
                ></lightning-combobox></td>
                    <td scope="row" class="slds-text-align--center"><p class="slds-text-align--center">{request.type}</p></td>
                    <td scope="row" class="slds-text-align--center"><lightning-input data-index={index} class = 'input1' type="number" formatter="currency" variant ="label-hidden" step="0.01" label="Refund Amount" name="refund" value={request.refund} onchange ={resubmitInputChangeHandler}></lightning-input>
                    </td>
                    <td scope="row" class="slds-text-align--center"><lightning-input data-index={index} class = 'input2' type="number" formatter="currency" variant ="label-hidden" label="Coupon" step="0.01" name="coupon" value={request.coupon} onchange ={resubmitInputChangeHandler}></lightning-input>
                    </td>
                    <td scope="row" class="slds-text-align--center"><p class="slds-text-align--center">{request.approvalStage}</p></td>
                    </tr>
                </template>
                </tbody>
                </table>
        </div>
        <div class="buttons slds-align_absolute-center" style="margin-top: 4rem">
            <lightning-button variant="brand" label="Resubmit" title="Resubmit" name="resubmit" onclick={resubmitHandler} class="slds-m-left_x-small"></lightning-button>
            <lightning-button variant="neutral" label="Back" title="Back" name="back" onclick={handleSaveAndCancel} class="slds-m-left_x-small"></lightning-button>
        </div>
</template>
<template lwc:if={showApprovalHistory}>
<div class="slds-box slds-m-top_small">
    <div class="slds-text-heading_medium slds-text-align--center"><b>Approval History</b></div>
    <template for:each={apprHistory} for:item="rec" for:index ="index">
        <lightning-accordion allow-multiple-sections-open
        key ={rec.Id}
        onsectiontoggle={handleSectionToggle}>
        <lightning-accordion-section name={index} label={rec.description}>
            <table class="slds-table slds-table--bordered slds-table--cell-buffer slds-table--striped slds-max-medium-table--stacked-horizontal"
                               role="grid">
                            <thead>
                                <tr class="slds-line-height_reset slds-text-heading_small">
                                    <th scope="col" width="22%" class="slds-text-align_center"><b>Name</b></th>
                                    <th scope="col" width="13%" class="slds-text-align_center"><b>Reason</b></th>
                                    <th scope="col" width="13%" class="slds-text-align_center"><b>Amount</b></th>
                                    <th scope="col" width="11%" class="slds-text-align_center"><b>Refund</b></th>
                                    <th scope="col" width="11%" class="slds-text-align_center"><b>Coupon</b></th>
                                    <th scope="col" width="13%" class="slds-text-align_center"><b>Approval Status</b></th>
                                </tr>      
                            </thead>
                            <tbody>
                                    <tr class="slds-hint-parent">
                                        <td scope="row" class="slds-text-align--center">{rec.name}</td>
                                        <td scope="row" class="slds-text-align--center">{rec.refundReason}</td>
                                        <td scope="row" class="slds-text-align--center">$&nbsp;{rec.totalCancellationAmount}</td>
                                        <td scope="row" class="slds-text-align--center">$&nbsp;{rec.refund}</td>
                                        <td scope="row" class="slds-text-align--center">$&nbsp;{rec.coupon}</td>
                                        <td scope="row" class="slds-text-align--center">{rec.status}</td>
                                    </tr>
                            </tbody>
                            </table>
        </lightning-accordion-section>
    </lightning-accordion>
    </template>
</div>
</template>
</template>
</template>