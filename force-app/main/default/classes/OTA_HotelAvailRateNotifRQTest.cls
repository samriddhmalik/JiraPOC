@isTest
public class OTA_HotelAvailRateNotifRQTest {
    
    @isTest
    static void testHttpPostError() {
        // prepare test-data
        
        //As Per Best Practice it is important to instantiate the Rest Context
        RestRequest req = new RestRequest();
        RestResponse res = new RestResponse();
        
        req.requestURI = '/services/apexrest/Something'; //Request URL
        req.httpMethod = 'POST';
       // String postData ='{"rateAmountMessages":{"rateAmountMessage":[{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.10,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":23,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":24,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":25,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":25,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":300.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":26,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":27,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":300.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":28,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":29,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":30,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":31,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":1,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":7,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":8,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":12,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":13,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":14,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}}],"hotelCode":"CP121"},"timeStamp":{"year":2021,"month":3,"day":16,"timezone":0,"hour":11,"minute":57,"second":57},"version":1.0,"echoToken":"d0a89176-00ba-4b2a-9ca4-946dc0c982d0"}';
         String postData ='{"rateAmountMessages": {"rateAmountMessage": [{"statusApplicationControl": {"invTypeCode": "PSWP","ratePlanCode": "BAR","start": "2024-10-21","endDate": "2024-10-21"},"rates": {"rate": {"baseByGuestAmts": {"baseByGuestAmt": [{"ageQualifyingCode": 10,"numberOfGuests": 2,"amountAfterTax": 200.00,"currencyCode": "AUD"}]},"additionalGuestAmounts": {"additionalGuestAmount": [{"ageQualifyingCode": 10,"amount": 200.00,"currencyCode": "AUD"}]},"rateDescription": {"text": ""}}}}],"hotelCode": "CP121"},"timeStamp": "2022-01-01T09:30:47+08:00","version": 1.0,"echoToken": "d0a89176-00ba-4b2a-9ca4-946dc0c"}'; 
        req.requestBody=Blob.valueof(postData);
        RestContext.request = req;
        RestContext.response= res;
        
        Test.startTest();
        OTA_HotelAvailRateNotifRQ.createRateDetailsRecords();
        Test.stopTest();
        
    }
    
    @isTest
    static void testHttpPostErrorNoHotel() {
        
        List<RecordType> RCTProductPartner = TADUtils.getRecordType(Label.TAD_RT_Product_Partner);
        List<RecordType> RCTTadDeal = TADUtils.getRecordType(Label.TAD_RT_TAD_Deal);
        Account account = TestDataFactory.createBussinessAccount(RCTProductPartner[0].Id);   // Bussiness account Inserted
        insert account;
        
        Deal__c deal = TestDataFactory.createMerchantDeal(RCTTadDeal[0].Id , account.Id );   // Deals created
        deal.RecordTypeId = Schema.SObjectType.Deal__c.getRecordTypeInfosByName().get('Hotel').getRecordTypeId();
        deal.Hotel_Code__c='CP121';
        insert deal;
        
        //As Per Best Practice it is important to instantiate the Rest Context
        RestRequest req = new RestRequest();
        RestResponse res = new RestResponse();
        
        req.requestURI = '/services/apexrest/Something'; //Request URL
        req.httpMethod = 'POST';
     //   String postData ='{"rateAmountMessages":{"rateAmountMessage":[{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.10,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":23,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":24,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":25,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":25,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":300.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":26,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":27,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":300.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":28,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":29,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":30,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":31,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":1,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":7,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":8,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":12,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":13,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":14,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}}],"hotelCode":"CP121"},"timeStamp":{"year":2021,"month":3,"day":16,"timezone":0,"hour":11,"minute":57,"second":57},"version":1.0,"echoToken":"d0a89176-00ba-4b2a-9ca4-946dc0c982d0"}';
        String postData ='{"rateAmountMessages": {"rateAmountMessage": [{"statusApplicationControl": {"invTypeCode": "PSWP","ratePlanCode": "BAR","start": "2024-10-21","endDate": "2024-10-21"},"rates": {"rate": {"baseByGuestAmts": {"baseByGuestAmt": [{"ageQualifyingCode": 10,"numberOfGuests": 2,"amountAfterTax": 200.00,"currencyCode": "AUD"}]},"additionalGuestAmounts": {"additionalGuestAmount": [{"ageQualifyingCode": 10,"amount": 200.00,"currencyCode": "AUD"}]},"rateDescription": {"text": ""}}}}],"hotelCode": "CP121"},"timeStamp": "2022-01-01T09:30:47+08:00","version": 1.0,"echoToken": "d0a89176-00ba-4b2a-9ca4-946dc0c"}'; 
        req.requestBody=Blob.valueof(postData);
        RestContext.request = req;
        RestContext.response= res;
        
        Test.startTest();
        OTA_HotelAvailRateNotifRQ.createRateDetailsRecords();
        Test.stopTest();
        
    }
    
    @isTest
    static void testHttpPostHotelExistWithRoomType() {
        
        List<RecordType> RCTProductPartner = TADUtils.getRecordType(Label.TAD_RT_Product_Partner);
        List<RecordType> RCTTadDeal = TADUtils.getRecordType(Label.TAD_RT_TAD_Deal);
        Account account = TestDataFactory.createBussinessAccount(RCTProductPartner[0].Id);   // Bussiness account Inserted
        insert account;
        
        Deal__c deal = TestDataFactory.createMerchantDeal(RCTTadDeal[0].Id , account.Id );   // Deals created
        deal.RecordTypeId = Schema.SObjectType.Deal__c.getRecordTypeInfosByName().get('Hotel').getRecordTypeId();
        deal.Hotel_Code__c='CP121';
        insert deal;
        
        options__c options =  TestDataFactory.CreateOptions(deal.Id); 
        insert options;
        
        Rate_Plan__c  rp = new Rate_Plan__c ();
        rp.Rate_Plan_Code__c='BAR';
        insert rp;
        
        sub_options__c subOptions = TestDataFactory.createSubOptions(options.Id);
        subOptions.Room_Type_Code__c ='PSWP';
        subOptions.RecordTypeId = Schema.SObjectType.sub_options__c.getRecordTypeInfosByName().get('Room Type').getRecordTypeId();
        subOptions.Rate_Plan__c =rp.id;
        insert subOptions;
        
        //As Per Best Practice it is important to instantiate the Rest Context
        RestRequest req = new RestRequest();
        RestResponse res = new RestResponse();
        
        req.requestURI = '/services/apexrest/Something'; //Request URL
        req.httpMethod = 'POST';
       // String postData ='{"rateAmountMessages":{"rateAmountMessage":[{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.10,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":23,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":24,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":25,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":25,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":300.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":26,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":27,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":300.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":28,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":29,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":30,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":31,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":1,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":7,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":8,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":12,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":13,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":14,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200.00,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}}],"hotelCode":"CP121"},"timeStamp":{"year":2021,"month":3,"day":16,"timezone":0,"hour":11,"minute":57,"second":57},"version":1.0,"echoToken":"d0a89176-00ba-4b2a-9ca4-946dc0c982d0"}';
        String postData ='{"rateAmountMessages": {"rateAmountMessage": [{"statusApplicationControl": {"invTypeCode": "PSWP","ratePlanCode": "BAR","start": "2024-10-21","endDate": "2024-10-21"},"rates": {"rate": {"baseByGuestAmts": {"baseByGuestAmt": [{"ageQualifyingCode": 10,"numberOfGuests": 2,"amountAfterTax": 200.00,"currencyCode": "AUD"}]},"additionalGuestAmounts": {"additionalGuestAmount": [{"ageQualifyingCode": 10,"amount": 200.00,"currencyCode": "AUD"}]},"rateDescription": {"text": ""}}}}],"hotelCode": "CP121"},"timeStamp": "2022-01-01T09:30:47+08:00","version": 1.0,"echoToken": "d0a89176-00ba-4b2a-9ca4-946dc0c"}'; 
        req.requestBody=Blob.valueof(postData);
        RestContext.request = req;
        RestContext.response= res;
        
        Test.startTest();
        OTA_HotelAvailRateNotifRQ.createRateDetailsRecords();
        Test.stopTest();
        
    }
    
    @isTest
    static void testHttpPostHotelExistWithRoomType1() {
        
        List<RecordType> RCTProductPartner = TADUtils.getRecordType(Label.TAD_RT_Product_Partner);
        List<RecordType> RCTTadDeal = TADUtils.getRecordType(Label.TAD_RT_TAD_Deal);
        Account account = TestDataFactory.createBussinessAccount(RCTProductPartner[0].Id);   // Bussiness account Inserted
        insert account;
        
        Deal__c deal = TestDataFactory.createMerchantDeal(RCTTadDeal[0].Id , account.Id );   // Deals created
        deal.RecordTypeId = Schema.SObjectType.Deal__c.getRecordTypeInfosByName().get('Hotel').getRecordTypeId();
        deal.Hotel_Code__c='CP121';
        insert deal;
        
        options__c options =  TestDataFactory.CreateOptions(deal.Id); 
        insert options;
        
        Rate_Plan__c  rp = new Rate_Plan__c ();
        rp.Rate_Plan_Code__c='BAR';
        insert rp;
        
        sub_options__c subOptions = TestDataFactory.createSubOptions(options.Id);
        subOptions.Room_Type_Code__c ='PSWP';
        subOptions.RecordTypeId = Schema.SObjectType.sub_options__c.getRecordTypeInfosByName().get('Room Type').getRecordTypeId();
        subOptions.Rate_Plan__c =rp.id;
        insert subOptions;
        
        //As Per Best Practice it is important to instantiate the Rest Context
        RestRequest req = new RestRequest();
        RestResponse res = new RestResponse();
        
        req.requestURI = '/services/apexrest/Something'; //Request URL
        req.httpMethod = 'POST';
      //  String postData ='{"rateAmountMessages":{"rateAmountMessage":[{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150,"currencyCode":"AUD"}]},"additionalGuestAmounts":{"additionalGuestAmount":[{"ageQualifyingCode":10,"amount":100,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150,"currencyCode":"AUD"}]},"additionalGuestAmounts":{"additionalGuestAmount":[{"ageQualifyingCode":10,"amount":100,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150.1,"currencyCode":"AUD"}]},"additionalGuestAmounts":{"additionalGuestAmount":[{"ageQualifyingCode":10,"amount":100,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":23,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":24,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":25,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":25,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":300,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":26,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":27,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":300,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":28,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":29,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":3,"day":30,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":31,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":1,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":7,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":8,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":12,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":150,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}},{"statusApplicationControl":{"invTypeCode":"PSWP","ratePlanCode":"BAR","start":{"year":2021,"month":4,"day":13,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":14,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648}},"rates":{"rate":{"baseByGuestAmts":{"baseByGuestAmt":[{"ageQualifyingCode":10,"numberOfGuests":2,"amountAfterTax":200,"currencyCode":"AUD"}]},"rateDescription":{"text":""}}}}],"hotelCode":"CP121"},"timeStamp":{"year":2021,"month":3,"day":16,"timezone":0,"hour":11,"minute":57,"second":57},"version":1,"echoToken":"d0a89176-00ba-4b2a-9ca4-946dc0c982d0"}';
        String postData ='{"rateAmountMessages": {"rateAmountMessage": [{"statusApplicationControl": {"invTypeCode": "PSWP","ratePlanCode": "BAR","start": "2024-10-21","endDate": "2024-10-21"},"rates": {"rate": {"baseByGuestAmts": {"baseByGuestAmt": [{"ageQualifyingCode": 10,"numberOfGuests": 2,"amountAfterTax": 200.00,"currencyCode": "AUD"}]},"additionalGuestAmounts": {"additionalGuestAmount": [{"ageQualifyingCode": 10,"amount": 200.00,"currencyCode": "AUD"}]},"rateDescription": {"text": ""}}}}],"hotelCode": "CP121"},"timeStamp": "2022-01-01T09:30:47+08:00","version": 1.0,"echoToken": "d0a89176-00ba-4b2a-9ca4-946dc0c"}'; 
        req.requestBody=Blob.valueof(postData);
        RestContext.request = req;
        RestContext.response= res;
        
        Test.startTest();
        OTA_HotelAvailRateNotifRQ.createRateDetailsRecords();
        Test.stopTest();
        
    }
  
}