@isTest
public class OTA_HotelAvailNotifRQ_OTAConnectTest {
@isTest
    static void testHttpPostError() {
        // prepare test-data
        
        //As Per Best Practice it is important to instantiate the Rest Context
        RestRequest req = new RestRequest();
        RestResponse res = new RestResponse();
        
        req.requestURI = '/services/apexrest/Something'; //Request URL
        req.httpMethod = 'POST';
        String postData = '{"POS": {"Source": {"BookingChannel": {"CompanyName": {"Code": "PartnerCode","text": "Partner Name"},"Type": "7"}}},"AvailStatusMessages": {"AvailStatusMessage": [{"StatusApplicationControl": {"Start": "01-06-2027","endDate": "01-06-2027","InvTypeCode": "GSR","RatePlanCode": "GLD"},"LengthsOfStay": {"LengthOfStay": {"MinMaxMessageType": "MinLOS","TimeUnit": "Day","minTime": "3"},"ArrivalDateBased": "true"}},{"StatusApplicationControl": {"Start": "02-06-2027","endDate": "02-06-2027","InvTypeCode": "GSR","RatePlanCode": "GLD"},"RestrictionStatus": {"Restriction": "Master","Status": "Open"}},{"StatusApplicationControl": {"Start": "03-06-2027", "endDate": "03-06-2027","InvTypeCode": "GSR","RatePlanCode": "GLD"},"RestrictionStatus": {"Restriction": "Arrival","Status": "Close"}}],"HotelCode": "CP121"}}';
       // String postData = '{"availStatusMessages":{"availStatusMessage":[{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","time":2},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","time":1},{"minMaxMessageType":"SetMaxLOS","time":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}}],"hotelCode":"CP121"},"version":1,"timeStamp":{"year":2021,"month":3,"day":16,"timezone":0,"hour":11,"minute":31,"second":52},"echoToken":"0c406b18-9e25-4c06-bc0b-728076a25e20"}';
       // String postData = '{"availStatusMessages":{"availStatusMessage":[{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":2},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}}],"hotelCode":"CP121"},"version":1,"timeStamp":{"year":2021,"month":3,"day":16,"timezone":0,"hour":11,"minute":31,"second":52},"echoToken":"0c406b18-9e25-4c06-bc0b-728076a25e20"}';
        req.requestBody=Blob.valueof(postData);
        RestContext.request = req;
       // RestContext.request.params.put('HotelCode','CP1213456789');
        RestContext.response= res;
        
        Test.startTest();
        OTA_HotelAvailNotifRQ_OTAConnect.createDepDatesAndAllocationTables();
        Test.stopTest();
        
    }
     @isTest
    static void testHttpPostHotelExistWithRoomType() {
        
        List<RecordType> RCTProductPartner = TADUtils.getRecordType(Label.TAD_RT_Product_Partner);
        List<RecordType> RCTTadDeal = TADUtils.getRecordType(Label.TAD_RT_TAD_Deal);
        Account account = TestDataFactory.createBussinessAccount(RCTProductPartner[0].Id);   // Bussiness account Inserted
        insert account;
        
        Deal__c deal = TestDataFactory.createMerchantDeal(RCTTadDeal[0].Id , account.Id );   // Deals created
        deal.RecordTypeId = Schema.SObjectType.Deal__c.getRecordTypeInfosByName().get('Hotel').getRecordTypeId();
        deal.Hotel_Code__c='CP121';
        deal.Channel_Partner__c='TravelClick';
        deal.merchant_sharing_deadline__c = 10;
        insert deal;
        
        options__c options =  TestDataFactory.CreateOptions(deal.Id); 
        insert options;
        
        Rate_Plan__c  rp = new Rate_Plan__c ();
        rp.Rate_Plan_Code__c='GLD';
        insert rp;
            
        sub_options__c subOptions = TestDataFactory.createSubOptions(options.Id);
        
        subOptions.Room_Type_Code__c ='PSWP';
        subOptions.RecordTypeId = Schema.SObjectType.sub_options__c.getRecordTypeInfosByName().get('Room Type').getRecordTypeId();
        subOptions.Rate_Plan__c =rp.id;
        insert subOptions;
        
        //As Per Best Practice it is important to instantiate the Rest Context
        RestRequest req = new RestRequest();
        RestResponse res = new RestResponse();
        
        req.requestURI = '/services/apexrest/Something'; //Request URL
        req.httpMethod = 'POST';
         String postData = '{"POS": {"Source": {"BookingChannel": {"CompanyName": {"Code": "PartnerCode","text": "Partner Name"},"Type": "7"}}},"AvailStatusMessages": {"AvailStatusMessage": [{"StatusApplicationControl": {"Start": "01-06-2027","endDate": "01-06-2027","InvTypeCode": "GSR","RatePlanCode": "GLD"},"LengthsOfStay": {"LengthOfStay": {"MinMaxMessageType": "MinLOS","TimeUnit": "Day","minTime": "3"},"ArrivalDateBased": "true"}},{"StatusApplicationControl": {"Start": "02-06-2027","endDate": "02-06-2027","InvTypeCode": "GSR","RatePlanCode": "GLD"},"RestrictionStatus": {"Restriction": "Master","Status": "Open"}},{"StatusApplicationControl": {"Start": "03-06-2027", "endDate": "03-06-2027","InvTypeCode": "GSR","RatePlanCode": "GLD"},"RestrictionStatus": {"Restriction": "Arrival","Status": "Close"}}],"HotelCode": "CP121"}}';
        //String postData ='{"availStatusMessages":{"availStatusMessage":[{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":2},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Close"},"bookingLimit":20},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Close","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Close","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":19},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":19},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Close","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":24},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}}],"hotelCode":"CP121"},"version":1.0,"timeStamp":{"year":2021,"month":3,"day":16,"timezone":0,"hour":11,"minute":31,"second":52},"echoToken":"0c406b18-9e25-4c06-bc0b-728076a25e20"}';
            req.requestBody=Blob.valueof(postData);
        RestContext.request = req;
         //RestContext.request.params.put('HotelCode','CP121');
        RestContext.response= res;
        
        Test.startTest();
       OTA_HotelAvailNotifRQ_OTAConnect.createDepDatesAndAllocationTables();
        Test.stopTest();
        
    }
    
    
    
    @isTest
    static void testHttpPostHotelExistWithRoomType1() {
        
        List<RecordType> RCTProductPartner = TADUtils.getRecordType(Label.TAD_RT_Product_Partner);
        List<RecordType> RCTTadDeal = TADUtils.getRecordType(Label.TAD_RT_TAD_Deal);
        Account account = TestDataFactory.createBussinessAccount(RCTProductPartner[0].Id);   // Bussiness account Inserted
        insert account;
        
        Deal__c deal = TestDataFactory.createMerchantDeal(RCTTadDeal[0].Id , account.Id );   // Deals created
        deal.RecordTypeId = Schema.SObjectType.Deal__c.getRecordTypeInfosByName().get('Hotel').getRecordTypeId();
        deal.Hotel_Code__c='CP121';
        deal.Channel_Partner__c='TravelClick';
        deal.merchant_sharing_deadline__c = 10;
        deal.merchant_sharing_deadline_date__c = system.today() + 10;
        insert deal;
        
        options__c options =  TestDataFactory.CreateOptions(deal.Id); 
        insert options;
        
        Rate_Plan__c  rp = new Rate_Plan__c ();
        rp.Rate_Plan_Code__c='GLD';
        insert rp;
            
        sub_options__c subOptions = TestDataFactory.createSubOptions(options.Id);
        subOptions.Room_Type_Code__c ='GSR';
        subOptions.RecordTypeId = Schema.SObjectType.sub_options__c.getRecordTypeInfosByName().get('Room Type').getRecordTypeId();
        subOptions.Rate_Plan__c =rp.id;
        insert subOptions;
        
       /* departures_dates__c dd = TestDataFactory.createDepartureDates(deal.Id, options.Id,subOptions.id);
        dd.date__c= date.newInstance(2021, 05, 17);
        insert dd;*/
        
        //As Per Best Practice it is important to instantiate the Rest Context
        RestRequest req = new RestRequest();
        RestResponse res = new RestResponse();
        
        req.requestURI = '/services/apexrest/Something'; //Request URL
        req.httpMethod = 'POST';
         String postData = '{"POS":{"Source":{"BookingChannel":{"CompanyName":{"Code":"PartnerCode","text":"Partner Name"},"Type":"7"}}},"AvailStatusMessages":{"AvailStatusMessage":[{"StatusApplicationControl":{"Start":"2027-06-01","endDate":"2027-06-03","InvTypeCode":"GSR","RatePlanCode":"GLD"},"LengthsOfStay":{"LengthOfStay":{"MinMaxMessageType":"MinLOS","TimeUnit":"Day","minTime":"3"},"ArrivalDateBased":"true"}}],"HotelCode":"CP121"}}';
            //String postData ='{"availStatusMessages":{"availStatusMessage":[{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":2},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":18,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":19,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Close"},"bookingLimit":20},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Close","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":20,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Close","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":21,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":15},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":3,"day":22,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":19},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":4,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":19},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Close","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":5,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open"},"bookingLimit":24},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"lengthsOfStay":{"lengthOfStay":[{"minMaxMessageType":"SetMinLOS","minMaxTime":1},{"minMaxMessageType":"SetMaxLOS","minMaxTime":0}]}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Arrival"}},{"statusApplicationControl":{"start":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"endDate":{"year":2021,"month":4,"day":6,"timezone":-2147483648,"hour":-2147483648,"minute":-2147483648,"second":-2147483648},"invTypeCode":"PSWP","ratePlanCode":"BAR"},"restrictionStatus":{"status":"Open","restriction":"Departure"}}],"hotelCode":"CP121"},"version":1.0,"timeStamp":{"year":2021,"month":3,"day":16,"timezone":0,"hour":11,"minute":31,"second":52},"echoToken":"0c406b18-9e25-4c06-bc0b-728076a25e20"}';
            req.requestBody=Blob.valueof(postData);
        RestContext.request = req;
         //RestContext.request.params.put('HotelCode','CP121');
        RestContext.response= res;
        
        Test.startTest();
       OTA_HotelAvailNotifRQ_OTAConnect.createDepDatesAndAllocationTables();
        Test.stopTest();
        
    }
    
     
}