@IsTest
public class PNRGetReIssueReservationTest {
    public HTTPResponse respond(HTTPRequest request) {
        // Create a fake response
        HttpResponse response = new HttpResponse();
        response.setHeader('Content-Type', 'application/json');
        //response.setBody('{ "reservation": { "bookingDetails": { "recordLocator": "KAOMUL", "creationTimestamp": 1657628580000, "systemCreationTimestamp": 1657628580000, "creationAgentID": "ASS", "updateTimestamp": 1657629135000, "flightsRange": { "start": 1665917100000, "end_Z": 1666611000000 }, "divideSplitDetails": "<stl19:DivideSplitDetails xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "estimatedPurgeTimestamp": 1667826000000, "updateToken": "-32ac6a9aeac2c703f634928c6cef25bf004a867bc2e716b0", "pnrsequence": 9 }, "pos": { "source": { "bookingSource": "XX0I", "agentSine": "ASS", "pseudoCityCode": "XX0I", "agentDutyCode": "*", "airlineVendorID": "AA", "homePseudoCityCode": "XX0I", "isocountry": "AU" } }, "passengerReservation": { "passengers": { "passenger": [ { "lastName": "HAYNES", "firstName": "MARTIN WILLIAM MR", "specialRequests": { "genericSpecialRequest": null, "apisrequest": { "docaentry": null } }, "seats": "<stl19:Seats xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "id": 13, "nameType": "S", "passengerType": "ADT", "nameId": 1.01, "nameAssocId": 1, "elementId": "pnr-13.1" }, { "lastName": "CAMPBELL", "firstName": "PENNY LEW MS", "specialRequests": { "genericSpecialRequest": null, "apisrequest": { "docaentry": null } }, "seats": "<stl19:Seats xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "id": 15, "nameType": "S", "passengerType": "ADT", "nameId": 2.01, "nameAssocId": 2, "elementId": "pnr-15.2" } ] }, "segments": { "poc": { "airport": "SYD", "departure": 1665917100000 }, "segment": [ { "air": { "status":true, "segmentRecordId": null, "departureAirport": "SYD", "departureAirportCodeContext": "IATA", "departureTerminalName": "TERMINAL 1 INTERNATIONAL", "departureTerminalCode": "1", "arrivalAirport": "DXB", "arrivalAirportCodeContext": "IATA", "arrivalTerminalName": "TERMINAL 3", "arrivalTerminalCode": "3", "operatingAirlineCode": "EK", "operatingAirlineShortName": "EMIRATES", "operatingFlightNumber": 413, "equipmentType": "388", "marketingAirlineCode": "EK", "marketingFlightNumber": 413, "operatingClassOfService": "T", "marketingClassOfService": "T", "marriageGrp": { "ind": 0, "group_Z": 0, "sequence": 0 }, "seats": "<stl19:Seats xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "airlineRefId": "DCEK*KXGWPF", "eticket": true, "departureDateTime": "2022-10-16T21:45:00", "arrivalDateTime": "2022-10-17T05:15:00", "flightNumber": "0413", "classOfService": "T", "actionCode": "HK", "numberInParty": 2, "segmentSpecialRequests": { "genericSpecialRequest": [ { "code": "TKNE", "freeText": "EK HK1 SYDDXB0413T16OCT/1765260225539C1", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225539, "fullText": "TKNE EK HK1 SYDDXB0413T16OCT/1765260225539C1", "id": 31, "type": "G", "msgType": "S" }, { "code": "TKNE", "freeText": "EK HK1 SYDDXB0413T16OCT/1765260225540C1", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225540, "fullText": "TKNE EK HK1 SYDDXB0413T16OCT/1765260225540C1", "id": 33, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 SYDDXB0413T16OCT/DB/03MAY1974/M/HAYNES/MARTIN/WILLIAM", "id": 62, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 SYDDXB0413T16OCT/DB/31DEC1981/F/CAMPBELL/PENNY/LEW", "id": 65, "type": "G", "msgType": "S" } ] }, "inboundConnection": false, "outboundConnection": false, "scheduleChangeIndicator": false, "segmentBookedDate": 1657628580000, "elapsedTime": "14.30", "airMilesFlown": 7480, "funnelFlight": false, "changeOfGauge": false, "id": 3, "sequence": 1, "segmentAssociationId": 2, "isPast": false }, "general": null, "sequence": 1, "id": 3, "ticketNumbers": "1765260225539C1;1765260225540C1;DB;DB" }, { "air": { "status": true, "segmentRecordId": null, "departureAirport": "DXB", "departureAirportCodeContext": "IATA", "departureTerminalName": "TERMINAL 3", "departureTerminalCode": "3", "arrivalAirport": "SYD", "arrivalAirportCodeContext": "IATA", "arrivalTerminalName": "TERMINAL 1 INTERNATIONAL", "arrivalTerminalCode": "1", "operatingAirlineCode": "EK", "operatingAirlineShortName": "EMIRATES", "operatingFlightNumber": 414, "equipmentType": "388", "marketingAirlineCode": "EK", "marketingFlightNumber": 414, "operatingClassOfService": "L", "marketingClassOfService": "L", "marriageGrp": { "ind": 0, "group_Z": 0, "sequence": 0 }, "seats": "<stl19:Seats xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "airlineRefId": "DCEK*KXGWPF", "eticket": true, "departureDateTime": "2022-10-24T01:50:00", "arrivalDateTime": "2022-10-24T22:30:00", "flightNumber": "0414", "classOfService": "L", "actionCode": "HK", "numberInParty": 2, "segmentSpecialRequests": { "genericSpecialRequest": [ { "code": "TKNE", "freeText": "EK HK1 DXBSYD0414L24OCT/1765260225539C2", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225539, "fullText": "TKNE EK HK1 DXBSYD0414L24OCT/1765260225539C2", "id": 32, "type": "G", "msgType": "S" }, { "code": "TKNE", "freeText": "EK HK1 DXBSYD0414L24OCT/1765260225540C2", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225540, "fullText": "TKNE EK HK1 DXBSYD0414L24OCT/1765260225540C2", "id": 34, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 DXBSYD0414L24OCT/DB/03MAY1974/M/HAYNES/MARTIN/WILLIAM", "id": 63, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 DXBSYD0414L24OCT/DB/31DEC1981/F/CAMPBELL/PENNY/LEW", "id": 66, "type": "G", "msgType": "S" } ] }, "inboundConnection": false, "outboundConnection": false, "scheduleChangeIndicator": false, "segmentBookedDate": 1657628580000, "elapsedTime": "13.40", "airMilesFlown": 7480, "funnelFlight": false, "changeOfGauge": false, "id": 4, "sequence": 2, "segmentAssociationId": 3, "isPast": false }, "general": null, "sequence": 2, "id": 4, "ticketNumbers": "1765260225539C2;1765260225540C2;DB;DB" } ] }, "ticketingInfo": { "alreadyTicketed": { "code": "T-13JUL-VT31*AWS", "id": 30, "index": 1, "elementId": "pnr-30" }, "ticketDetails": [ { "originalTicketDetails": "TE 1765260225539-AU HAYNE/M VT31*AWS 1327/13JUL*I", "transactionIndicator": "TE", "ticketNumber": 1765260225539, "passengerName": "HAYNE/M", "agencyLocation": "VT31", "dutyCode": "*", "agentSine": "AWS", "timestamp": 1657682820000, "paymentType": "*", "id": 27, "index": 2, "elementId": "pnr-27" }, { "originalTicketDetails": "TE 1765260225540-AU CAMPB/P VT31*AWS 1327/13JUL*I", "transactionIndicator": "TE", "ticketNumber": 1765260225540, "passengerName": "CAMPB/P", "agencyLocation": "VT31", "dutyCode": "*", "agentSine": "AWS", "timestamp": 1657682820000, "paymentType": "*", "id": 28, "index": 3, "elementId": "pnr-28" } ], "eticketNumber": [ { "value": "TE 1765260225539-AU HAYNE/M VT31*AWS 1327/13JUL*I", "id": 27, "index": 2, "elementId": "pnr-27" }, { "value": "TE 1765260225540-AU CAMPB/P VT31*AWS 1327/13JUL*I", "id": 28, "index": 3, "elementId": "pnr-28" } ] }, "itineraryPricing": { "pricedItinerary": [ { "airItineraryPricingInfo": { "itinTotalFare": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "total": { "value": 1864.48, "x_currencyCode": "AUD" }, "taxes": { "tax": { "amount": { "value": 174.48, "x_currencyCode": "AUD" }, "code": "XT" }, "taxBreakdownCode": [ { "value": "60.00AU", "taxPaid": false }, { "value": "64.18WY", "taxPaid": false }, { "value": "30.20AE", "taxPaid": false }, { "value": "2.00TP", "taxPaid": false }, { "value": "4.00ZR", "taxPaid": false }, { "value": "14.10F6", "taxPaid": false } ] }, "totals": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "totalTax": { "value": 174.48, "x_currencyCode": "AUD" }, "total": { "value": 1864.48, "x_currencyCode": "AUD" }, "code": "NN" }, "code": "NN" }, "ticketingFees": { "feeInformation": [ { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": "X", "amount": 0, "accountData": 1611, "currenyCode": "<stl19:CurrenyCode xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "description": "<stl19:Description xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>" }, { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": " ", "amount": 17, "accountData": null, "currenyCode": "<stl19:CurrenyCode xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "description": "<stl19:Description xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>" } ], "disclaimer": "ONE OR MORE FORM OF PAYMENT FEES MAY APPLY  ACTUAL TOTAL WILL BE BASED ON FORM OF PAYMENT USED FEE CODE     DESCRIPTION                         FEE" }, "signatureLine": { "text": "XX0I XX0I *ASS 2223/12JUL", "expirationDateTime": 1657979940000 }, "ptcfareBreakdown": { "passengerTypeQuantity": { "code": "ADT", "quantity": 2 }, "fareBasisCode": [ "TLXMPAU1", "LLXMPAU1" ], "fareCalc": "SYD EK DXB584.27EK SYD631.02NUC1215.29END ROE1.390601", "flightSegment": [ { "departureDateTime": "2022-10-16T21:45:00", "resBookDesigCode": "T", "flightNumber": "413", "actionCode": "OK", "flightType": "O", "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": "EK", "fareBasisCode": "TLXMPAU1", "validityDates": { "notValidAfter": "16OCT2022" }, "rph": 1 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null }, { "departureDateTime": "2022-10-24T01:50:00", "resBookDesigCode": "L", "flightNumber": "414", "actionCode": "OK", "flightType": "O", "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": "EK", "fareBasisCode": "LLXMPAU1", "validityDates": { "notValidAfter": "24OCT2022" }, "rph": 2 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null } ], "fareComponent": [ { "location_Z": { "origin": "SYD", "destination": "DXB" }, "dates": { "departureDateTime": "10-16T21:45", "arrivalDateTime": "10-17T05:15" }, "flightSegmentNumbers": { "flightSegmentNumber": 1 }, "fareBasisCode": "TLXMPAU1", "fareDirectionality": "FROM", "amount": 58427, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 1 }, { "location_Z": { "origin": "DXB", "destination": "SYD" }, "dates": { "departureDateTime": "10-24T01:50", "arrivalDateTime": "10-24T22:30" }, "flightSegmentNumbers": { "flightSegmentNumber": 2 }, "fareBasisCode": "LLXMPAU1", "fareDirectionality": "TO", "amount": 63102, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 2 } ], "passengerTypeRequested": { "code": "ADT" }, "passengerTypePriced": { "code": "ADT" } } }, "taxExempt": "N", "statusCode": "A", "sequenceNumber": 1, "inputMessage": "WPRQ", "validatingCarrier": "EK" }, { "airItineraryPricingInfo": { "itinTotalFare": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "total": { "value": 1879.28, "x_currencyCode": "AUD" }, "taxes": { "tax": { "amount": { "value": 189.28, "x_currencyCode": "AUD" }, "code": "XT" }, "taxBreakdownCode": [ { "value": "60.00AU", "taxPaid": false }, { "value": "64.18WY", "taxPaid": false }, { "value": "14.80YR", "taxPaid": false }, { "value": "30.20AE", "taxPaid": false }, { "value": "2.00TP", "taxPaid": false }, { "value": "4.00ZR", "taxPaid": false }, { "value": "14.10F6", "taxPaid": false } ] }, "totals": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "totalTax": { "value": 189.28, "x_currencyCode": "AUD" }, "total": { "value": 1879.28, "x_currencyCode": "AUD" }, "code": "NN" }, "code": "NN" }, "ticketingFees": { "feeInformation": [ { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": "X", "amount": 0, "accountData": 1611, "currenyCode": "<stl19:CurrenyCode xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "description": "<stl19:Description xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>" }, { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": " ", "amount": 17.1, "accountData": null, "currenyCode": "<stl19:CurrenyCode xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "description": "<stl19:Description xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>" } ], "disclaimer": "ONE OR MORE FORM OF PAYMENT FEES MAY APPLY  ACTUAL TOTAL WILL BE BASED ON FORM OF PAYMENT USED FEE CODE     DESCRIPTION                         FEE" }, "signatureLine": { "text": "VT31 07ZA *AWS 2224/12JUL", "expirationDateTime": 1657979940000 }, "ptcfareBreakdown": { "passengerTypeQuantity": { "code": "ADT", "quantity": 2 }, "fareBasisCode": [ "TLXMPAU1", "LLXMPAU1" ], "fareCalc": "SYD EK DXB584.27EK SYD631.02NUC1215.29END ROE1.390601", "flightSegment": [ { "departureDateTime": "2022-10-16T21:45:00", "resBookDesigCode": "T", "flightNumber": "413", "actionCode": "OK", "flightType": "O", "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": "EK", "fareBasisCode": "TLXMPAU1", "validityDates": { "notValidAfter": "16OCT2022" }, "rph": 1 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null }, { "departureDateTime": "2022-10-24T01:50:00", "resBookDesigCode": "L", "flightNumber": "414", "actionCode": "OK", "flightType": "O", "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": "EK", "fareBasisCode": "LLXMPAU1", "validityDates": { "notValidAfter": "24OCT2022" }, "rph": 2 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null } ], "fareComponent": [ { "location_Z": { "origin": "SYD", "destination": "DXB" }, "dates": { "departureDateTime": "10-16T21:45", "arrivalDateTime": "10-17T05:15" }, "flightSegmentNumbers": { "flightSegmentNumber": 1 }, "fareBasisCode": "TLXMPAU1", "fareDirectionality": "FROM", "amount": 58427, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 1 }, { "location_Z": { "origin": "DXB", "destination": "SYD" }, "dates": { "departureDateTime": "10-24T01:50", "arrivalDateTime": "10-24T22:30" }, "flightSegmentNumbers": { "flightSegmentNumber": 2 }, "fareBasisCode": "LLXMPAU1", "fareDirectionality": "TO", "amount": 63102, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 2 } ], "passengerTypeRequested": { "code": "ADT" }, "passengerTypePriced": { "code": "ADT" } } }, "taxExempt": "N", "statusCode": "A", "sequenceNumber": 2, "inputMessage": "WPRQ$AEK$PL$P2ADT$N1.1/2.1", "validatingCarrier": "EK" } ] } }, "receivedFrom": { "name": "SS" }, "addresses": { "address": { "addressLines": { "addressLine": [ { "text": "TRIPADEAL", "id": 50, "type": "O" }, { "text": "15 WOLLONGBAR STREET", "id": 51, "type": "O" }, { "text": "BYRON BAY NSW 2481", "id": 52, "type": "O" }, { "text": "AU", "id": 53, "type": "O" } ] } } }, "phoneNumbers": { "phoneNumber": { "cityCode": "SYD", "number_Z": "61287763938 TRIP A DEAL", "id": 59, "index": 2, "elementId": "pnr-59" } }, "remarks": { "remark": [ { "remarkLines": { "remarkLine": { "text": "XXTAWXX0I16JUL143/1100P/" } }, "index": 1, "id": 29, "type": "REG", "code": null, "elementId": "pnr-29" }, { "remarkLines": { "remarkLine": { "text": ".. QUIKTRAVEL DATA... 13JUL22 132744" } }, "index": 2, "id": 37, "type": "INVOICE", "code": null, "elementId": "pnr-37" }, { "remarkLines": { "remarkLine": { "text": "INV NO. 17888401       ACCOUNT. BNE050532 PAYABLE. 1862.38" } }, "index": 3, "id": 38, "type": "REG", "code": null, "elementId": "pnr-38" }, { "remarkLines": { "remarkLine": { "text": "TKT NO. 176-5260225539 ISSUE. 13JUL22     AIRLINE. EK" } }, "index": 4, "id": 39, "type": "REG", "code": null, "elementId": "pnr-39" }, { "remarkLines": { "remarkLine": { "text": "PAX   . HAYNES/MARTIN WILLIAM MR" } }, "index": 5, "id": 40, "type": "REG", "code": null, "elementId": "pnr-40" }, { "remarkLines": { "remarkLine": { "text": "FARE  .        1690.00 TAXES.    189.28 SERVICE FEE.   0.00" } }, "index": 6, "id": 41, "type": "REG", "code": null, "elementId": "pnr-41" }, { "remarkLines": { "remarkLine": { "text": "COMM ON FARE.    16.90                  COMM ON TAX.   0.00" } }, "index": 7, "id": 42, "type": "REG", "code": null, "elementId": "pnr-42" }, { "remarkLines": { "remarkLine": { "text": "INV NO. 17888401       ACCOUNT. BNE050532 PAYABLE. 1862.38" } }, "index": 8, "id": 43, "type": "REG", "code": null, "elementId": "pnr-43" }, { "remarkLines": { "remarkLine": { "text": "TKT NO. 176-5260225540 ISSUE. 13JUL22     AIRLINE. EK" } }, "index": 9, "id": 44, "type": "REG", "code": null, "elementId": "pnr-44" }, { "remarkLines": { "remarkLine": { "text": "PAX   . CAMPBELL/PENNY LEW MS" } }, "index": 10, "id": 45, "type": "REG", "code": null, "elementId": "pnr-45" }, { "remarkLines": { "remarkLine": { "text": "FARE  .        1690.00 TAXES.    189.28 SERVICE FEE.   0.00" } }, "index": 11, "id": 46, "type": "REG", "code": null, "elementId": "pnr-46" }, { "remarkLines": { "remarkLine": { "text": "COMM ON FARE.    16.90                  COMM ON TAX.   0.00" } }, "index": 12, "id": 47, "type": "REG", "code": null, "elementId": "pnr-47" }, { "remarkLines": { "remarkLine": { "text": "...END QUIKTRAVEL DATA...." } }, "index": 13, "id": 48, "type": "INVOICE", "code": null, "elementId": "pnr-48" }, { "remarkLines": { "remarkLine": { "text": "ID-NF" } }, "index": 14, "id": 55, "type": "CODED", "code": "Z", "elementId": "pnr-55" } ] }, "emailAddresses": { "emailAddress": { "address": "BOOKINGS@TRIPADEAL.COM.AU", "comment": "<stl19:Comment xmlns:stl19=\"http://webservices.sabre.com/pnrbuilder/v1_19\" xmlns:ns4=\"http://webservices.sabre.com/pnrconn/ReaccSearch\" xmlns:ns6=\"http://services.sabre.com/res/orr/v0\" xmlns:or114=\"http://services.sabre.com/res/or/v1_14\" xmlns:raw=\"http://tds.sabre.com/itinerary\" xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\"/>", "id": 54 } }, "accountingLines": { "accountingLine": [ { "fareApplication": "ONE", "formOfPaymentCode": "CA", "airlineDesignator": "EK", "documentNumber": "5260225539", "commissionAmount": 16.9, "baseFare": 1690, "taxAmount": 189.28, "passengerName": "HAYNES MARTIN WILLIAM MR", "numberOfConjunctedDocuments": 1, "numberOfCoupons": null, "originalTicketNumber": null, "tarriffBasis": "F", "pnrAccLineRecordId":null, "status": true, "isExchanged": false, "id": 25, "index": 1, "elementId": "pnr-25" }, { "fareApplication": "ONE", "formOfPaymentCode": "CA", "airlineDesignator": "EK", "documentNumber": "5260225540", "commissionAmount": 16.9, "baseFare": 1690, "taxAmount": 189.28, "passengerName": "CAMPBELL PENNY LEW MS", "numberOfConjunctedDocuments": 1, "numberOfCoupons": null, "originalTicketNumber": null, "tarriffBasis": "F", "pnrAccLineRecordId": null, "": true, "isExchanged": false, "id": 26, "index": 2, "elementId": "pnr-26" } ] }, "genericSpecialRequests": [ { "code": "ADTK", "freeText": "RITK/ADTKT BY 20JUL 1423 SYD LT", "airlineCode": "AA", "fullText": "ADTK AA  RITK/ADTKT BY 20JUL 1423 SYD LT", "id": 23, "type": "A", "msgType": "S" }, { "code": "APIN", "freeText": "200020518865", "airlineCode": "EY", "fullText": "EY APIN 200020518865", "id": 56, "type": "G", "msgType": "O" }, { "code": null, "freeText": "TRIPADEAL 135 777", "airlineCode": "YY", "fullText": "YY TRIPADEAL 135 777", "id": 57, "type": "G", "msgType": "O" } ], "profiles": { "profile": { "profileID": 181571956, "profileType": "AGY", "id": 58 } }, "numberInParty": 2, "numberOfInfants": 0, "numberInSegment": 2 }, "version": "1.19.0", "recordsUpdated": null, "segmentsUpdated": null, "accountingUpdated": null, "isManualSync": null, "reasonForManualSync": null }');
        response.setBody('{"access_token":"bT9rVg6Q8bluroYnuPOgNt6nM00yt","expires_in":3600,"token_type":"Bearer"}');
        response.setStatusCode(200);
        return response;
    }
    @IsTest
    public static void method1() {
        List<RecordType> RCTProductPartner = TADUtils.getRecordType(Label.TAD_RT_Product_Partner);
        Account acctBussiness = TestDataFactory.createBussinessAccount(RCTProductPartner[0].Id);   // Bussiness account Inserted
        insert acctBussiness; 
        
        List<RecordType> RCTTadDeal = TADUtils.getRecordType(Label.TAD_RT_TAD_Deal);
        
        Deal__c deal = TestDataFactory.createMerchantDeal(RCTTadDeal[0].Id , acctBussiness.Id );   // Deals created
        deal.Allocation_by__c='Deal';
        deal.merchant_sharing_deadline__c=10;
        deal.Primary_Country__c = 'Australia';
        insert deal;
        
        Generic_Records__c  gr = new Generic_Records__c ();
        gr.Coupon_Name__c = 'testdatetvalue';
        gr.Is_Assigned__c = false;
        gr.Sequence_Number_Expedia__c = 700000;
        gr.Sequence_Number_tad__c = 280000;
        gr.Type__c ='TAD';
        insert gr;
        
        
        
        options__c options = TestDataFactory.CreateOptions(deal.Id);       // Options crested using the deal
        options.itinerary_context__c='1';
        insert options;
        
        sub_options__c subOptions = TestDataFactory.createSubOptions(options.Id);   // Sub options created
        subOptions.STD_OPT__c ='Standard';
        subOptions.Deal__c = deal.id  ;
        insert subOptions;
        
        departure_cities__c departureCities = TestDataFactory.createDepartureCities(deal.Id);       // Departure cities created
        insert departureCities;
        Allocation__c acc = TestDataFactory.createAllocationDeal(deal);
        insert acc;
        
        departures_dates__c departureDates = TestDataFactory.createDDWithAllocation(deal,null,null,acc);
        departureDates.Linked_Deal_D_O_S__c = deal.Id;
        insert departureDates;
        
        
        
        List<RecordType> RCTPersonAccount = TADUtils.getRecordType(Label.TAD_RT_TAD_Person_Account);
        Account acctPerson = TestDataFactory.createPersonAccount(RCTPersonAccount[0].Id);
        insert acctPerson;
        
        
        
        ID RTTADOrder1 = Schema.SObjectType.Tad_Order__C.getRecordTypeInfosByDeveloperName().get('TAD').getRecordTypeId();
        Tad_Order__C order1 = TestDataFactory.createTADOrder(acctPerson,deal,options,departureDates,RTTADOrder1);
        order1.ordexp_master_status__c = 'On Hold';
        order1.ordexp_sub_status__c = 'Initial Payment Pending';
        order1.ordexp_gross_amount__c=100;
        insert order1;
        
        Order_Line_Item__c oli = TestDataFactory.createOrderLineItem(order1,subOptions,departureCities,'2',options,deal);
        oli.Pricing_Model__c='Twin';
        oli.OLI_Status__c = 'On Hold';      
        insert oli;
        
        List<customer_POE__c> customerList = new list<customer_POE__c>();
        customer_POE__c pax = TestDataFactory.createPassenger(oli,order1);
        pax.first_name__c = 'MARTIN';
        pax.last_name__c = 'HAYNES';
        pax.second_name__c = 'WILLIAM';
        customerList.add(pax);
        
        customer_POE__c pax1= TestDataFactory.createPassenger(oli,order1);
        pax1.first_name__c = 'PENNY';
        pax1.last_name__c = 'CAMPBELL';
        pax1.second_name__c = 'LEW';
        
        customerList.add(pax1);
        
        insert customerList;
        
        PNR_POE__c pnr =  TestDataFactory.createPNR(order1,acctPerson);
        pnr.name='xyz';
        insert pnr;
        PNR_POE__c pnr1 = [Select id, Name, PNR_Sequence__c, Creation_Agent_Id__c, Base_Price__c, Base_Price_Currency__c, Equiv_Price__c, Equiv_Price_Currency__c, Total_Tax__c, Total_Tax_Currency__c, Total_Price__c, Total_Price_Currency__c from PNR_POE__c where id=:pnr.id];
        //As Per Best Practice it is important to instantiate the Rest Context
        PNR_Accounting_Line_POE__c pal = new PNR_Accounting_Line_POE__c();
        pal.pnr__c = pnr1.Id;
        
        insert pal;
        PNR_Accounting_Line_POE__c pal1= new PNR_Accounting_Line_POE__c();
        pal1.pnr__c = pnr1.Id;
        insert pal1;
        
        List<Segment_POE__c> segListToInsert=new list<Segment_POE__c>();
        Segment_POE__c seg =  TestDataFactory.createSegment(pnr);
        seg.Eticket__c = true;
        Segment_POE__c seg1 =  TestDataFactory.createSegment(pnr);
        seg.Eticket__c = true;
        segListToInsert.add(seg);
        segListToInsert.add(seg1);
        insert segListToInsert;
        
        RestRequest req = new RestRequest();
        RestResponse res = new RestResponse();
        system.debug('pnr1'+pnr1.Name);
        req.requestURI = '/services/apexrest/Sabre_GetReservationRS/'; //Request URL
        req.httpMethod = 'POST';
        String putData = '{ "reservation": { "bookingDetails": { "recordLocator": "'+pnr1.Name+'", "creationTimestamp": 1657628580000, "systemCreationTimestamp": 1657628580000, "creationAgentID": "ASS", "updateTimestamp": 1657629135000, "flightsRange": { "start": 1665917100000, "end_Z": 1666611000000 }, "divideSplitDetails": "", "estimatedPurgeTimestamp": 1667826000000, "updateToken": "-32ac6a9aeac2c703f634928c6cef25bf004a867bc2e716b0", "pnrsequence": 9 }, "pos": { "source": { "bookingSource": "XX0I", "agentSine": "ASS", "pseudoCityCode": "XX0I", "agentDutyCode": "*", "airlineVendorID": "AA", "homePseudoCityCode": "XX0I", "isocountry": "AU" } }, "passengerReservation": { "passengers": { "passenger": [ { "lastName": "HAYNES", "firstName": "MARTIN WILLIAM MR", "specialRequests": { "genericSpecialRequest": null, "apisrequest": { "docaentry": null } }, "seats": "", "id": 13, "nameType": "S", "passengerType": "ADT", "nameId": 1.01, "nameAssocId": 1, "elementId": "pnr-13.1" }, { "lastName": "CAMPBELL", "firstName": "PENNY LEW MS", "specialRequests": { "genericSpecialRequest": null, "apisrequest": { "docaentry": null } }, "seats": "", "id": 15, "nameType": "S", "passengerType": "ADT", "nameId": 2.01, "nameAssocId": 2, "elementId": "pnr-15.2" } ] }, "segments": { "poc": { "airport": "SYD", "departure": 1665917100000 }, "segment": [ { "air": { "status": true, "segmentRecordId":"'+seg.id+'", "departureAirport": "DXB", "departureAirportCodeContext": "IATA", "departureTerminalName": "TERMINAL 1 INTERNATIONAL", "departureTerminalCode": "1", "arrivalAirport": "SYD", "arrivalAirportCodeContext": "IATA", "arrivalTerminalName": "TERMINAL 3", "arrivalTerminalCode": "3", "operatingAirlineCode": "EK", "operatingAirlineShortName": "EMIRATES", "operatingFlightNumber": 413, "equipmentType": "388", "marketingAirlineCode": "EK", "marketingFlightNumber": 413, "operatingClassOfService": "T", "marketingClassOfService": "T", "marriageGrp": { "ind": 0, "group_Z": 0, "sequence": 0 }, "seats": "", "airlineRefId": "DCEK*KXGWPF", "eticket": true, "departureDateTime": "2022-10-16T21:45:00", "arrivalDateTime": "2022-10-17T05:15:00", "flightNumber": "0413", "classOfService": "T", "actionCode": "HK", "numberInParty": 2, "segmentSpecialRequests": { "genericSpecialRequest": [ { "code": "TKNE", "freeText": "EK HK1 SYDDXB0413T16OCT/1765260225539C1", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225539, "fullText": "TKNE EK HK1 SYDDXB0413T16OCT/1765260225539C1", "id": 31, "type": "G", "msgType": "S" }, { "code": "TKNE", "freeText": "EK HK1 SYDDXB0413T16OCT/1765260225540C1", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225540, "fullText": "TKNE EK HK1 SYDDXB0413T16OCT/1765260225540C1", "id": 33, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 SYDDXB0413T16OCT/DB/03MAY1974/M/HAYNES/MARTIN/WILLIAM", "id": 62, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 SYDDXB0413T16OCT/DB/31DEC1981/F/CAMPBELL/PENNY/LEW", "id": 65, "type": "G", "msgType": "S" } ] }, "inboundConnection": false, "outboundConnection": false, "scheduleChangeIndicator": false, "segmentBookedDate": 1657628580000, "elapsedTime": "14.30", "airMilesFlown": 7480, "funnelFlight": false, "changeOfGauge": false, "id": 3, "sequence": 1, "segmentAssociationId": 2, "isPast": false }, "general": null, "sequence": 1, "id": 3, "ticketNumbers": "1765260225539C1;1765260225540C1;DB;DB" }, { "air": { "status": true, "segmentRecordId": "'+seg1.id+'", "departureAirport": "SYD", "departureAirportCodeContext": "IATA", "departureTerminalName": "TERMINAL 3", "departureTerminalCode": "3", "arrivalAirport": "DXB", "arrivalAirportCodeContext": "IATA", "arrivalTerminalName": "TERMINAL 1 INTERNATIONAL", "arrivalTerminalCode": "1", "operatingAirlineCode": "EK", "operatingAirlineShortName": "EMIRATES", "operatingFlightNumber": 414, "equipmentType": "388", "marketingAirlineCode": "EK", "marketingFlightNumber": 414, "operatingClassOfService": "L", "marketingClassOfService": "L", "marriageGrp": { "ind": 0, "group_Z": 0, "sequence": 0 }, "seats": "", "airlineRefId": "DCEK*KXGWPF", "eticket": true, "departureDateTime": "2022-10-24T01:50:00", "arrivalDateTime": "2022-10-24T22:30:00", "flightNumber": "0414", "classOfService": "L", "actionCode": "HK", "numberInParty": 2, "segmentSpecialRequests": { "genericSpecialRequest": [ { "code": "TKNE", "freeText": "EK HK1 DXBSYD0414L24OCT/1765260225539C2", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225539, "fullText": "TKNE EK HK1 DXBSYD0414L24OCT/1765260225539C2", "id": 32, "type": "G", "msgType": "S" }, { "code": "TKNE", "freeText": "EK HK1 DXBSYD0414L24OCT/1765260225540C2", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225540, "fullText": "TKNE EK HK1 DXBSYD0414L24OCT/1765260225540C2", "id": 34, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 DXBSYD0414L24OCT/DB/03MAY1974/M/HAYNES/MARTIN/WILLIAM", "id": 63, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 DXBSYD0414L24OCT/DB/31DEC1981/F/CAMPBELL/PENNY/LEW", "id": 66, "type": "G", "msgType": "S" } ] }, "inboundConnection": false, "outboundConnection": false, "scheduleChangeIndicator": false, "segmentBookedDate": 1657628580000, "elapsedTime": "13.40", "airMilesFlown": 7480, "funnelFlight": false, "changeOfGauge": false, "id": 4, "sequence": 2, "segmentAssociationId": 3, "isPast": false }, "general": null, "sequence": 2, "id": 4, "ticketNumbers": "1765260225539C2;1765260225540C2;DB;DB" } ] }, "ticketingInfo": { "alreadyTicketed": { "code": "T-13JUL-VT31*AWS", "id": 30, "index": 1, "elementId": "pnr-30" }, "ticketDetails": [ { "originalTicketDetails": "TE 1765260225539-AU HAYNE/M VT31*AWS 1327/13JUL*I", "transactionIndicator": "TE", "ticketNumber": 1765260225539, "passengerName": "HAYNE/M", "agencyLocation": "VT31", "dutyCode": "*", "agentSine": "AWS", "timestamp": 1657682820000, "paymentType": "*", "id": 27, "index": 2, "elementId": "pnr-27" }, { "originalTicketDetails": "TE 1765260225540-AU CAMPB/P VT31*AWS 1327/13JUL*I", "transactionIndicator": "TE", "ticketNumber": 1765260225540, "passengerName": "CAMPB/P", "agencyLocation": "VT31", "dutyCode": "*", "agentSine": "AWS", "timestamp": 1657682820000, "paymentType": "*", "id": 28, "index": 3, "elementId": "pnr-28" } ], "eticketNumber": [ { "value": "TE 1765260225539-AU HAYNE/M VT31*AWS 1327/13JUL*I", "id": 27, "index": 2, "elementId": "pnr-27" }, { "value": "TE 1765260225540-AU CAMPB/P VT31*AWS 1327/13JUL*I", "id": 28, "index": 3, "elementId": "pnr-28" } ] }, "itineraryPricing": { "pricedItinerary": [ { "airItineraryPricingInfo": { "itinTotalFare": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "total": { "value": 1864.48, "x_currencyCode": "AUD" }, "taxes": { "tax": { "amount": { "value": 174.48, "x_currencyCode": "AUD" }, "code": "XT" }, "taxBreakdownCode": [ { "value": "60.00AU", "taxPaid": false }, { "value": "64.18WY", "taxPaid": false }, { "value": "30.20AE", "taxPaid": false }, { "value": "2.00TP", "taxPaid": false }, { "value": "4.00ZR", "taxPaid": false }, { "value": "14.10F6", "taxPaid": false } ] }, "totals": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "totalTax": { "value": 174.48, "x_currencyCode": "AUD" }, "total": { "value": 1864.48, "x_currencyCode": "AUD" }, "code": "NN" }, "code": "NN" }, "ticketingFees": { "feeInformation": [ { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": "X", "amount": 0, "accountData": 1611, "currenyCode": "", "description": "" }, { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": " ", "amount": 17, "accountData": null, "currenyCode": "", "description": "" } ], "disclaimer": "ONE OR MORE FORM OF PAYMENT FEES MAY APPLY  ACTUAL TOTAL WILL BE BASED ON FORM OF PAYMENT USED FEE CODE     DESCRIPTION                         FEE" }, "signatureLine": { "text": "XX0I XX0I *ASS 2223/12JUL", "expirationDateTime": 1657979940000 }, "ptcfareBreakdown": { "passengerTypeQuantity": { "code": "ADT", "quantity": 2 }, "fareBasisCode": [ "TLXMPAU1", "LLXMPAU1" ], "fareCalc": "SYD EK DXB584.27EK SYD631.02NUC1215.29END ROE1.390601", "flightSegment": [ { "departureDateTime": "2022-10-16T21:45:00", "resBookDesigCode": "T", "flightNumber": "413", "actionCode": "OK", "flightType": "O", "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": "EK", "fareBasisCode": "TLXMPAU1", "validityDates": { "notValidAfter": "16OCT2022" }, "rph": 1 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null }, { "departureDateTime": "2022-10-24T01:50:00", "resBookDesigCode": "L", "flightNumber": "414", "actionCode": "OK", "flightType": "O", "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": "EK", "fareBasisCode": "LLXMPAU1", "validityDates": { "notValidAfter": "24OCT2022" }, "rph": 2 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null } ], "fareComponent": [ { "location_Z": { "origin": "SYD", "destination": "DXB" }, "dates": { "departureDateTime": "10-16T21:45", "arrivalDateTime": "10-17T05:15" }, "flightSegmentNumbers": { "flightSegmentNumber": 1 }, "fareBasisCode": "TLXMPAU1", "fareDirectionality": "FROM", "amount": 58427, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 1 }, { "location_Z": { "origin": "DXB", "destination": "SYD" }, "dates": { "departureDateTime": "10-24T01:50", "arrivalDateTime": "10-24T22:30" }, "flightSegmentNumbers": { "flightSegmentNumber": 2 }, "fareBasisCode": "LLXMPAU1", "fareDirectionality": "TO", "amount": 63102, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 2 } ], "passengerTypeRequested": { "code": "ADT" }, "passengerTypePriced": { "code": "ADT" } } }, "taxExempt": "N", "statusCode": "A", "sequenceNumber": 1, "inputMessage": "WPRQ", "validatingCarrier": "EK" }, { "airItineraryPricingInfo": { "itinTotalFare": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "total": { "value": 1879.28, "x_currencyCode": "AUD" }, "taxes": { "tax": { "amount": { "value": 189.28, "x_currencyCode": "AUD" }, "code": "XT" }, "taxBreakdownCode": [ { "value": "60.00AU", "taxPaid": false }, { "value": "64.18WY", "taxPaid": false }, { "value": "14.80YR", "taxPaid": false }, { "value": "30.20AE", "taxPaid": false }, { "value": "2.00TP", "taxPaid": false }, { "value": "4.00ZR", "taxPaid": false }, { "value": "14.10F6", "taxPaid": false } ] }, "totals": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "totalTax": { "value": 189.28, "x_currencyCode": "AUD" }, "total": { "value": 1879.28, "x_currencyCode": "AUD" }, "code": "NN" }, "code": "NN" }, "ticketingFees": { "feeInformation": [ { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": "X", "amount": 0, "accountData": 1611, "currenyCode": "", "description": "" }, { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": " ", "amount": 17.1, "accountData": null, "currenyCode": "", "description": "" } ], "disclaimer": "ONE OR MORE FORM OF PAYMENT FEES MAY APPLY  ACTUAL TOTAL WILL BE BASED ON FORM OF PAYMENT USED FEE CODE     DESCRIPTION                         FEE" }, "signatureLine": { "text": "VT31 07ZA *AWS 2224/12JUL", "expirationDateTime": 1657979940000 }, "ptcfareBreakdown": { "passengerTypeQuantity": { "code": "ADT", "quantity": 2 }, "fareBasisCode": [ "TLXMPAU1", "LLXMPAU1" ], "fareCalc": "SYD EK DXB584.27EK SYD631.02NUC1215.29END ROE1.390601", "flightSegment": [ { "departureDateTime": "2022-10-16T21:45:00", "resBookDesigCode": "T", "flightNumber": "413", "actionCode": "OK", "flightType": "O", "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": "EK", "fareBasisCode": "TLXMPAU1", "validityDates": { "notValidAfter": "16OCT2022" }, "rph": 1 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null }, { "departureDateTime": "2022-10-24T01:50:00", "resBookDesigCode": "L", "flightNumber": "414", "actionCode": "OK", "flightType": "O", "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": "EK", "fareBasisCode": "LLXMPAU1", "validityDates": { "notValidAfter": "24OCT2022" }, "rph": 2 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null } ], "fareComponent": [ { "location_Z": { "origin": "SYD", "destination": "DXB" }, "dates": { "departureDateTime": "10-16T21:45", "arrivalDateTime": "10-17T05:15" }, "flightSegmentNumbers": { "flightSegmentNumber": 1 }, "fareBasisCode": "TLXMPAU1", "fareDirectionality": "FROM", "amount": 58427, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 1 }, { "location_Z": { "origin": "DXB", "destination": "SYD" }, "dates": { "departureDateTime": "10-24T01:50", "arrivalDateTime": "10-24T22:30" }, "flightSegmentNumbers": { "flightSegmentNumber": 2 }, "fareBasisCode": "LLXMPAU1", "fareDirectionality": "TO", "amount": 63102, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 2 } ], "passengerTypeRequested": { "code": "ADT" }, "passengerTypePriced": { "code": "ADT" } } }, "taxExempt": "N", "statusCode": "A", "sequenceNumber": 2, "inputMessage": "WPRQ$AEK$PL$P2ADT$N1.1/2.1", "validatingCarrier": "EK" } ] } }, "receivedFrom": { "name": "SS" }, "addresses": { "address": { "addressLines": { "addressLine": [ { "text": "TRIPADEAL", "id": 50, "type": "O" }, { "text": "15 WOLLONGBAR STREET", "id": 51, "type": "O" }, { "text": "BYRON BAY NSW 2481", "id": 52, "type": "O" }, { "text": "AU", "id": 53, "type": "O" } ] } } }, "phoneNumbers": { "phoneNumber": { "cityCode": "SYD", "number_Z": "61287763938 TRIP A DEAL", "id": 59, "index": 2, "elementId": "pnr-59" } }, "remarks": { "remark": [ { "remarkLines": { "remarkLine": { "text": "XXTAWXX0I16JUL143/1100P/" } }, "index": 1, "id": 29, "type": "REG", "code": null, "elementId": "pnr-29" }, { "remarkLines": { "remarkLine": { "text": ".. QUIKTRAVEL DATA... 13JUL22 132744" } }, "index": 2, "id": 37, "type": "INVOICE", "code": null, "elementId": "pnr-37" }, { "remarkLines": { "remarkLine": { "text": "INV NO. 17888401       ACCOUNT. BNE050532 PAYABLE. 1862.38" } }, "index": 3, "id": 38, "type": "REG", "code": null, "elementId": "pnr-38" }, { "remarkLines": { "remarkLine": { "text": "TKT NO. 176-5260225539 ISSUE. 13JUL22     AIRLINE. EK" } }, "index": 4, "id": 39, "type": "REG", "code": null, "elementId": "pnr-39" }, { "remarkLines": { "remarkLine": { "text": "PAX   . HAYNES/MARTIN WILLIAM MR" } }, "index": 5, "id": 40, "type": "REG", "code": null, "elementId": "pnr-40" }, { "remarkLines": { "remarkLine": { "text": "FARE  .        1690.00 TAXES.    189.28 SERVICE FEE.   0.00" } }, "index": 6, "id": 41, "type": "REG", "code": null, "elementId": "pnr-41" }, { "remarkLines": { "remarkLine": { "text": "COMM ON FARE.    16.90                  COMM ON TAX.   0.00" } }, "index": 7, "id": 42, "type": "REG", "code": null, "elementId": "pnr-42" }, { "remarkLines": { "remarkLine": { "text": "INV NO. 17888401       ACCOUNT. BNE050532 PAYABLE. 1862.38" } }, "index": 8, "id": 43, "type": "REG", "code": null, "elementId": "pnr-43" }, { "remarkLines": { "remarkLine": { "text": "TKT NO. 176-5260225540 ISSUE. 13JUL22     AIRLINE. EK" } }, "index": 9, "id": 44, "type": "REG", "code": null, "elementId": "pnr-44" }, { "remarkLines": { "remarkLine": { "text": "PAX   . CAMPBELL/PENNY LEW MS" } }, "index": 10, "id": 45, "type": "REG", "code": null, "elementId": "pnr-45" }, { "remarkLines": { "remarkLine": { "text": "FARE  .        1690.00 TAXES.    189.28 SERVICE FEE.   0.00" } }, "index": 11, "id": 46, "type": "REG", "code": null, "elementId": "pnr-46" }, { "remarkLines": { "remarkLine": { "text": "COMM ON FARE.    16.90                  COMM ON TAX.   0.00" } }, "index": 12, "id": 47, "type": "REG", "code": null, "elementId": "pnr-47" }, { "remarkLines": { "remarkLine": { "text": "...END QUIKTRAVEL DATA...." } }, "index": 13, "id": 48, "type": "INVOICE", "code": null, "elementId": "pnr-48" }, { "remarkLines": { "remarkLine": { "text": "ID-NF" } }, "index": 14, "id": 55, "type": "CODED", "code": "Z", "elementId": "pnr-55" } ] }, "emailAddresses": { "emailAddress": { "address": "BOOKINGS@TRIPADEAL.COM.AU", "comment": "", "id": 54 } }, "accountingLines": { "accountingLine": [ { "fareApplication": "ONE", "formOfPaymentCode": "CA", "airlineDesignator": "EK", "documentNumber": "5260225539", "commissionAmount": 16.9, "baseFare": 1690, "taxAmount": 189.28, "passengerName": "HAYNES MARTIN WILLIAM MR", "numberOfConjunctedDocuments": 1, "numberOfCoupons": null, "originalTicketNumber": null, "tarriffBasis": "F", "pnrAccLineRecordId": "'+pal1.id+'", "status": true, "isExchanged": false, "id": 25, "index": 1, "elementId": "pnr-25" }, { "fareApplication": "ONE", "formOfPaymentCode": "CA", "airlineDesignator": "EK", "documentNumber": "5260225540", "commissionAmount": 16.9, "baseFare": 1690, "taxAmount": 189.28, "passengerName": "CAMPBELL PENNY LEW MS", "numberOfConjunctedDocuments": 1, "numberOfCoupons": null, "originalTicketNumber": null, "tarriffBasis": "F", "pnrAccLineRecordId": "'+pal.id+'", "status": true, "isExchanged": false, "id": 26, "index": 2, "elementId": "pnr-26" } ] }, "genericSpecialRequests": [ { "code": "ADTK", "freeText": "RITK/ADTKT BY 20JUL 1423 SYD LT", "airlineCode": "AA", "fullText": "ADTK AA  RITK/ADTKT BY 20JUL 1423 SYD LT", "id": 23, "type": "A", "msgType": "S" }, { "code": "APIN", "freeText": "200020518865", "airlineCode": "EY", "fullText": "EY APIN 200020518865", "id": 56, "type": "G", "msgType": "O" }, { "code": null, "freeText": "TRIPADEAL 135 777", "airlineCode": "YY", "fullText": "YY TRIPADEAL 135 777", "id": 57, "type": "G", "msgType": "O" } ], "profiles": { "profile": { "profileID": 181571956, "profileType": "AGY", "id": 58 } }, "numberInParty": 2, "numberOfInfants": 0, "numberInSegment": 2 }, "version": "1.19.0", "recordsUpdated": true, "segmentsUpdated": true, "accountingUpdated": true, "isManualSync": null, "reasonForManualSync": null }';
            req.requestBody=Blob.valueof(putData);
        RestContext.request = req;
        //req.params.put('appSessionCode',accc.app_session__c);
        // req.params.put('accountSFId',accc.id);
        // req.params.put('token','xyz');
        RestContext.response= res;
        Test.setMock(HttpCalloutMock.class, new PNRGetReservationApiTest());
        
        
        Test.startTest();
        PNRGetReIssueReservation.createPNRAccountingLineAndSegmentRecord();
        Test.stopTest();
    }  
    @IsTest
    public static void method2() {
        List<RecordType> RCTProductPartner = TADUtils.getRecordType(Label.TAD_RT_Product_Partner);
        Account acctBussiness = TestDataFactory.createBussinessAccount(RCTProductPartner[0].Id);   // Bussiness account Inserted
        insert acctBussiness; 
        
        List<RecordType> RCTTadDeal = TADUtils.getRecordType(Label.TAD_RT_TAD_Deal);
        
        Deal__c deal = TestDataFactory.createMerchantDeal(RCTTadDeal[0].Id , acctBussiness.Id );   // Deals created
        deal.Allocation_by__c='Deal';
        deal.merchant_sharing_deadline__c=10;
        deal.Primary_Country__c = 'Australia';
        insert deal;
        
        Generic_Records__c  gr = new Generic_Records__c ();
        gr.Coupon_Name__c = 'testdatetvalue';
        gr.Is_Assigned__c = false;
        gr.Sequence_Number_Expedia__c = 700000;
        gr.Sequence_Number_tad__c = 280000;
        gr.Type__c ='TAD';
        insert gr;
        
        options__c options = TestDataFactory.CreateOptions(deal.Id);       // Options crested using the deal
        options.itinerary_context__c='1';
        insert options;
        
        sub_options__c subOptions = TestDataFactory.createSubOptions(options.Id);   // Sub options created
        subOptions.STD_OPT__c ='Standard';
        subOptions.Deal__c = deal.id  ;
        insert subOptions;
        
        departure_cities__c departureCities = TestDataFactory.createDepartureCities(deal.Id);       // Departure cities created
        insert departureCities;
                
        Allocation__c acc = TestDataFactory.createAllocationDeal(deal);
        insert acc;
        
        departures_dates__c departureDates = TestDataFactory.createDDWithAllocation(deal,null,null,acc);
        departureDates.Linked_Deal_D_O_S__c = deal.Id;
        insert departureDates;
        
        List<RecordType> RCTPersonAccount = TADUtils.getRecordType(Label.TAD_RT_TAD_Person_Account);
        Account acctPerson = TestDataFactory.createPersonAccount(RCTPersonAccount[0].Id);
        insert acctPerson;
        
        ID RTTADOrder1 = Schema.SObjectType.Tad_Order__C.getRecordTypeInfosByDeveloperName().get('TAD').getRecordTypeId();
        Tad_Order__C order1 = TestDataFactory.createTADOrder(acctPerson,deal,options,departureDates,RTTADOrder1);
        order1.ordexp_master_status__c = 'On Hold';
        order1.ordexp_sub_status__c = 'Initial Payment Pending';
        order1.ordexp_gross_amount__c=100;
        insert order1;
        
        Order_Line_Item__c oli = TestDataFactory.createOrderLineItem(order1,subOptions,departureCities,'2',options,deal);
        oli.Pricing_Model__c='Twin';
        oli.OLI_Status__c = 'On Hold';      
        insert oli;
        
        List<customer_POE__c> customerList = new list<customer_POE__c>();
        customer_POE__c pax = TestDataFactory.createPassenger(oli,order1);
        pax.first_name__c = 'MARTIN';
        pax.last_name__c = 'HAYNES';
        pax.second_name__c = 'WILLIAM';
        customerList.add(pax);
        
        customer_POE__c pax1= TestDataFactory.createPassenger(oli,order1);
        pax1.first_name__c = 'PENNY';
        pax1.last_name__c = 'CAMPBELL';
        pax1.second_name__c = 'LEW';
        
        customerList.add(pax1);
        
        insert customerList;
        
        PNR_POE__c pnr =  TestDataFactory.createPNR(order1,acctPerson);
        pnr.name='xyz';
        insert pnr;
        
        PNR_POE__c pnr1 = [Select id, Name, PNR_Sequence__c, Creation_Agent_Id__c, Base_Price__c, Base_Price_Currency__c, Equiv_Price__c, Equiv_Price_Currency__c, Total_Tax__c, Total_Tax_Currency__c, Total_Price__c, Total_Price_Currency__c from PNR_POE__c where id=:pnr.id];
      
        //As Per Best Practice it is important to instantiate the Rest Context
        PNR_Accounting_Line_POE__c pal = new PNR_Accounting_Line_POE__c();
        pal.pnr__c = pnr1.Id;
        insert pal;
        
        PNR_Accounting_Line_POE__c pal1= new PNR_Accounting_Line_POE__c();
        pal1.pnr__c = pnr1.Id;
        insert pal1;
        
        List<Segment_POE__c> segListToInsert=new list<Segment_POE__c>();
        Segment_POE__c seg =  TestDataFactory.createSegment(pnr);
        seg.Eticket__c = true;
        Segment_POE__c seg1 =  TestDataFactory.createSegment(pnr);
        seg.Eticket__c = true;
        segListToInsert.add(seg);
        segListToInsert.add(seg1);
        insert segListToInsert;
        
        RestRequest req = new RestRequest();
        RestResponse res = new RestResponse();
        system.debug('pnr1'+pnr1.Name);
        req.requestURI = '/services/apexrest/Sabre_GetReservationRS/'; //Request URL
        req.httpMethod = 'POST';
        String putData ='{ "reservation": { "bookingDetails": { "recordLocator": "'+pnr1.Name+'", "creationTimestamp": 1657628580000, "systemCreationTimestamp": 1657628580000, "creationAgentID": "ASS", "updateTimestamp": 1657629135000, "flightsRange": { "start": 1665917100000, "end_Z": 1666611000000 }, "divideSplitDetails": "", "estimatedPurgeTimestamp": 1667826000000, "updateToken": "-32ac6a9aeac2c703f634928c6cef25bf004a867bc2e716b0", "pnrsequence": 9 }, "pos": { "source": { "bookingSource": "XX0I", "agentSine": "ASS", "pseudoCityCode": "XX0I", "agentDutyCode": "*", "airlineVendorID": "AA", "homePseudoCityCode": "XX0I", "isocountry": "AU" } }, "passengerReservation": { "passengers": { "passenger": [ { "lastName": "HAYNES", "firstName": "MARTIN WILLIAM MR", "specialRequests": { "genericSpecialRequest": null, "apisrequest": { "docaentry": null } }, "seats": "", "id": 13, "nameType": "S", "passengerType": "ADT", "nameId": 1.01, "nameAssocId": 1, "elementId": "pnr-13.1" }, { "lastName": "CAMPBELL", "firstName": "PENNY LEW MS", "specialRequests": { "genericSpecialRequest": null, "apisrequest": { "docaentry": null } }, "seats": "", "id": 15, "nameType": "S", "passengerType": "ADT", "nameId": 2.01, "nameAssocId": 2, "elementId": "pnr-15.2" } ] }, "segments": { "poc": { "airport": "SYD", "departure": 1665917100000 }, "segment": [ { "air": { "status": true, "segmentRecordId": "'+seg.id+'", "departureAirport": "SYD", "departureAirportCodeContext": "IATA", "departureTerminalName": "TERMINAL 1 INTERNATIONAL", "departureTerminalCode": "1", "arrivalAirport": "DXB", "arrivalAirportCodeContext": "IATA", "arrivalTerminalName": "TERMINAL 3", "arrivalTerminalCode": "3", "operatingAirlineCode": "EK", "operatingAirlineShortName": "EMIRATES", "operatingFlightNumber": 413, "equipmentType": "388", "marketingAirlineCode": "EK", "marketingFlightNumber": 413, "operatingClassOfService": "T", "marketingClassOfService": "T", "marriageGrp": { "ind": 0, "group_Z": 0, "sequence": 0 }, "seats": "", "airlineRefId": "DCEK*KXGWPF", "eticket": true, "departureDateTime": "2022-10-16T21:45:00", "arrivalDateTime": "2022-10-17T05:15:00", "flightNumber": "0413", "classOfService": "T", "actionCode": "HK", "numberInParty": 2, "segmentSpecialRequests": { "genericSpecialRequest": [ { "code": "TKNE", "freeText": "EK HK1 SYDDXB0413T16OCT/1765260225539C1", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225539, "fullText": "TKNE EK HK1 SYDDXB0413T16OCT/1765260225539C1", "id": 31, "type": "G", "msgType": "S" }, { "code": "TKNE", "freeText": "EK HK1 SYDDXB0413T16OCT/1765260225540C1", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225540, "fullText": "TKNE EK HK1 SYDDXB0413T16OCT/1765260225540C1", "id": 33, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 SYDDXB0413T16OCT/DB/03MAY1974/M/HAYNES/MARTIN/WILLIAM", "id": 62, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 SYDDXB0413T16OCT/DB/31DEC1981/F/CAMPBELL/PENNY/LEW", "id": 65, "type": "G", "msgType": "S" } ] }, "inboundConnection": false, "outboundConnection": false, "scheduleChangeIndicator": false, "segmentBookedDate": 1657628580000, "elapsedTime": "14.30", "airMilesFlown": 7480, "funnelFlight": false, "changeOfGauge": false, "id": 3, "sequence": 1, "segmentAssociationId": 2, "isPast": false }, "general": null, "sequence": 1, "id": 3, "ticketNumbers": "1765260225539C1;1765260225540C1;DB;DB" }, { "air": { "status": true, "segmentRecordId":"'+seg1.id+'", "departureAirport": "SYD", "departureAirportCodeContext": "IATA", "departureTerminalName": "TERMINAL 3", "departureTerminalCode": "3", "arrivalAirport": "DXB", "arrivalAirportCodeContext": "IATA", "arrivalTerminalName": "TERMINAL 1 INTERNATIONAL", "arrivalTerminalCode": "1", "operatingAirlineCode": "EK", "operatingAirlineShortName": "EMIRATES", "operatingFlightNumber": 414, "equipmentType": "388", "marketingAirlineCode": "EK", "marketingFlightNumber": 414, "operatingClassOfService": "L", "marketingClassOfService": "L", "marriageGrp": { "ind": 0, "group_Z": 0, "sequence": 0 }, "seats": "", "airlineRefId": "DCEK*KXGWPF", "eticket": true, "departureDateTime": "2022-10-24T01:50:00", "arrivalDateTime": "2022-10-24T22:30:00", "flightNumber": "0414", "classOfService": "L", "actionCode": "HK", "numberInParty": 2, "segmentSpecialRequests": { "genericSpecialRequest": [ { "code": "TKNE", "freeText": "EK HK1 DXBSYD0414L24OCT/1765260225539C2", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225539, "fullText": "TKNE EK HK1 DXBSYD0414L24OCT/1765260225539C2", "id": 32, "type": "G", "msgType": "S" }, { "code": "TKNE", "freeText": "EK HK1 DXBSYD0414L24OCT/1765260225540C2", "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": 1765260225540, "fullText": "TKNE EK HK1 DXBSYD0414L24OCT/1765260225540C2", "id": 34, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 DXBSYD0414L24OCT/DB/03MAY1974/M/HAYNES/MARTIN/WILLIAM", "id": 63, "type": "G", "msgType": "S" }, { "code": "DOCS", "freeText": null, "actionCode": "HK", "numberInParty": 1, "airlineCode": "EK", "ticketNumber": null, "fullText": "DOCS EK HK1 DXBSYD0414L24OCT/DB/31DEC1981/F/CAMPBELL/PENNY/LEW", "id": 66, "type": "G", "msgType": "S" } ] }, "inboundConnection": false, "outboundConnection": false, "scheduleChangeIndicator": false, "segmentBookedDate": 1657628580000, "elapsedTime": "13.40", "airMilesFlown": 7480, "funnelFlight": false, "changeOfGauge": false, "id": 4, "sequence": 2, "segmentAssociationId": 3, "isPast": false }, "general": null, "sequence": 2, "id": 4, "ticketNumbers": "1765260225539C2;1765260225540C2;DB;DB" } ] }, "ticketingInfo": { "alreadyTicketed": { "code": "T-13JUL-VT31*AWS", "id": 30, "index": 1, "elementId": "pnr-30" }, "ticketDetails": [ { "originalTicketDetails": "TE 1765260225539-AU HAYNE/M VT31*AWS 1327/13JUL*I", "transactionIndicator": "TE", "ticketNumber": 1765260225539, "passengerName": "HAYNE/M", "agencyLocation": "VT31", "dutyCode": "*", "agentSine": "AWS", "timestamp": 1657682820000, "paymentType": "*", "id": 27, "index": 2, "elementId": "pnr-27" }, { "originalTicketDetails": "TE 1765260225540-AU CAMPB/P VT31*AWS 1327/13JUL*I", "transactionIndicator": "TE", "ticketNumber": 1765260225540, "passengerName": "CAMPB/P", "agencyLocation": "VT31", "dutyCode": "*", "agentSine": "AWS", "timestamp": 1657682820000, "paymentType": "*", "id": 28, "index": 3, "elementId": "pnr-28" } ], "eticketNumber": [ { "value": "TE 1765260225539-AU HAYNE/M VT31*AWS 1327/13JUL*I", "id": 27, "index": 2, "elementId": "pnr-27" }, { "value": "TE 1765260225540-AU CAMPB/P VT31*AWS 1327/13JUL*I", "id": 28, "index": 3, "elementId": "pnr-28" } ] }, "itineraryPricing": { "pricedItinerary": [ { "airItineraryPricingInfo": { "itinTotalFare": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "total": { "value": 1864.48, "x_currencyCode": "AUD" }, "taxes": { "tax": { "amount": { "value": 174.48, "x_currencyCode": "AUD" }, "code": "XT" }, "taxBreakdownCode": [ { "value": "60.00AU", "taxPaid": false }, { "value": "64.18WY", "taxPaid": false }, { "value": "30.20AE", "taxPaid": false }, { "value": "2.00TP", "taxPaid": false }, { "value": "4.00ZR", "taxPaid": false }, { "value": "14.10F6", "taxPaid": false } ] }, "totals": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "totalTax": { "value": 174.48, "x_currencyCode": "AUD" }, "total": { "value": 1864.48, "x_currencyCode": "AUD" }, "code": "NN" }, "code": "NN" }, "ticketingFees": { "feeInformation": [ { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": "X", "amount": 0, "accountData": 1611, "currenyCode": "", "description": "" }, { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": " ", "amount": 17, "accountData": null, "currenyCode": "", "description": "" } ], "disclaimer": "ONE OR MORE FORM OF PAYMENT FEES MAY APPLY  ACTUAL TOTAL WILL BE BASED ON FORM OF PAYMENT USED FEE CODE     DESCRIPTION                         FEE" }, "signatureLine": { "text": "XX0I XX0I *ASS 2223/12JUL", "expirationDateTime": 1657979940000 }, "ptcfareBreakdown": { "passengerTypeQuantity": { "code": "ADT", "quantity": 2 }, "fareBasisCode": [ "TLXMPAU1", "LLXMPAU1" ], "fareCalc": "SYD EK DXB584.27EK SYD631.02NUC1215.29END ROE1.390601", "flightSegment": [ { "departureDateTime": "2022-10-16T21:45:00", "resBookDesigCode": "T", "flightNumber": "413", "actionCode": "OK", "flightType": "O", "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": "EK", "fareBasisCode": "TLXMPAU1", "validityDates": { "notValidAfter": "16OCT2022" }, "rph": 1 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null }, { "departureDateTime": "2022-10-24T01:50:00", "resBookDesigCode": "L", "flightNumber": "414", "actionCode": "OK", "flightType": "O", "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": "EK", "fareBasisCode": "LLXMPAU1", "validityDates": { "notValidAfter": "24OCT2022" }, "rph": 2 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null } ], "fareComponent": [ { "location_Z": { "origin": "SYD", "destination": "DXB" }, "dates": { "departureDateTime": "10-16T21:45", "arrivalDateTime": "10-17T05:15" }, "flightSegmentNumbers": { "flightSegmentNumber": 1 }, "fareBasisCode": "TLXMPAU1", "fareDirectionality": "FROM", "amount": 58427, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 1 }, { "location_Z": { "origin": "DXB", "destination": "SYD" }, "dates": { "departureDateTime": "10-24T01:50", "arrivalDateTime": "10-24T22:30" }, "flightSegmentNumbers": { "flightSegmentNumber": 2 }, "fareBasisCode": "LLXMPAU1", "fareDirectionality": "TO", "amount": 63102, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 2 } ], "passengerTypeRequested": { "code": "ADT" }, "passengerTypePriced": { "code": "ADT" } } }, "taxExempt": "N", "statusCode": "A", "sequenceNumber": 1, "inputMessage": "WPRQ", "validatingCarrier": "EK" }, { "airItineraryPricingInfo": { "itinTotalFare": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "total": { "value": 1879.28, "x_currencyCode": "AUD" }, "taxes": { "tax": { "amount": { "value": 189.28, "x_currencyCode": "AUD" }, "code": "XT" }, "taxBreakdownCode": [ { "value": "60.00AU", "taxPaid": false }, { "value": "64.18WY", "taxPaid": false }, { "value": "14.80YR", "taxPaid": false }, { "value": "30.20AE", "taxPaid": false }, { "value": "2.00TP", "taxPaid": false }, { "value": "4.00ZR", "taxPaid": false }, { "value": "14.10F6", "taxPaid": false } ] }, "totals": { "base": { "value": 1690, "x_currencyCode": "AUD" }, "totalTax": { "value": 189.28, "x_currencyCode": "AUD" }, "total": { "value": 1879.28, "x_currencyCode": "AUD" }, "code": "NN" }, "code": "NN" }, "ticketingFees": { "feeInformation": [ { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": "X", "amount": 0, "accountData": 1611, "currenyCode": "", "description": "" }, { "serviceType": "O", "onlineInterlineService": "N", "nonRefundableInd": "N", "nonCommissionInd": "N", "functionCode": "FCA", "displayOnOutputInd": " ", "amount": 17.1, "accountData": null, "currenyCode": "", "description": "" } ], "disclaimer": "ONE OR MORE FORM OF PAYMENT FEES MAY APPLY  ACTUAL TOTAL WILL BE BASED ON FORM OF PAYMENT USED FEE CODE     DESCRIPTION                         FEE" }, "signatureLine": { "text": "VT31 07ZA *AWS 2224/12JUL", "expirationDateTime": 1657979940000 }, "ptcfareBreakdown": { "passengerTypeQuantity": { "code": "ADT", "quantity": 2 }, "fareBasisCode": [ "TLXMPAU1", "LLXMPAU1" ], "fareCalc": "SYD EK DXB584.27EK SYD631.02NUC1215.29END ROE1.390601", "flightSegment": [ { "departureDateTime": "2022-10-16T21:45:00", "resBookDesigCode": "T", "flightNumber": "413", "actionCode": "OK", "flightType": "O", "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": "EK", "fareBasisCode": "TLXMPAU1", "validityDates": { "notValidAfter": "16OCT2022" }, "rph": 1 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null }, { "departureDateTime": "2022-10-24T01:50:00", "resBookDesigCode": "L", "flightNumber": "414", "actionCode": "OK", "flightType": "O", "airPort": { "value": "DXB", "name": "DUBAI" }, "operatingAirline": "EK", "fareBasisCode": "LLXMPAU1", "validityDates": { "notValidAfter": "24OCT2022" }, "rph": 2 }, { "departureDateTime": null, "resBookDesigCode": null, "flightNumber": null, "actionCode": null, "flightType": null, "airPort": { "value": "SYD", "name": "SYDNEY" }, "operatingAirline": null, "fareBasisCode": null, "validityDates": null, "rph": null } ], "fareComponent": [ { "location_Z": { "origin": "SYD", "destination": "DXB" }, "dates": { "departureDateTime": "10-16T21:45", "arrivalDateTime": "10-17T05:15" }, "flightSegmentNumbers": { "flightSegmentNumber": 1 }, "fareBasisCode": "TLXMPAU1", "fareDirectionality": "FROM", "amount": 58427, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 1 }, { "location_Z": { "origin": "DXB", "destination": "SYD" }, "dates": { "departureDateTime": "10-24T01:50", "arrivalDateTime": "10-24T22:30" }, "flightSegmentNumbers": { "flightSegmentNumber": 2 }, "fareBasisCode": "LLXMPAU1", "fareDirectionality": "TO", "amount": 63102, "ticketDesignator": "", "governingCarrier": "EK", "fareComponentNumber": 2 } ], "passengerTypeRequested": { "code": "ADT" }, "passengerTypePriced": { "code": "ADT" } } }, "taxExempt": "N", "statusCode": "A", "sequenceNumber": 2, "inputMessage": "WPRQ$AEK$PL$P2ADT$N1.1/2.1", "validatingCarrier": "EK" } ] } }, "receivedFrom": { "name": "SS" }, "addresses": { "address": { "addressLines": { "addressLine": [ { "text": "TRIPADEAL", "id": 50, "type": "O" }, { "text": "15 WOLLONGBAR STREET", "id": 51, "type": "O" }, { "text": "BYRON BAY NSW 2481", "id": 52, "type": "O" }, { "text": "AU", "id": 53, "type": "O" } ] } } }, "phoneNumbers": { "phoneNumber": { "cityCode": "SYD", "number_Z": "61287763938 TRIP A DEAL", "id": 59, "index": 2, "elementId": "pnr-59" } }, "remarks": { "remark": [ { "remarkLines": { "remarkLine": { "text": "XXTAWXX0I16JUL143/1100P/" } }, "index": 1, "id": 29, "type": "REG", "code": null, "elementId": "pnr-29" }, { "remarkLines": { "remarkLine": { "text": ".. QUIKTRAVEL DATA... 13JUL22 132744" } }, "index": 2, "id": 37, "type": "INVOICE", "code": null, "elementId": "pnr-37" }, { "remarkLines": { "remarkLine": { "text": "INV NO. 17888401       ACCOUNT. BNE050532 PAYABLE. 1862.38" } }, "index": 3, "id": 38, "type": "REG", "code": null, "elementId": "pnr-38" }, { "remarkLines": { "remarkLine": { "text": "TKT NO. 176-5260225539 ISSUE. 13JUL22     AIRLINE. EK" } }, "index": 4, "id": 39, "type": "REG", "code": null, "elementId": "pnr-39" }, { "remarkLines": { "remarkLine": { "text": "PAX   . HAYNES/MARTIN WILLIAM MR" } }, "index": 5, "id": 40, "type": "REG", "code": null, "elementId": "pnr-40" }, { "remarkLines": { "remarkLine": { "text": "FARE  .        1690.00 TAXES.    189.28 SERVICE FEE.   0.00" } }, "index": 6, "id": 41, "type": "REG", "code": null, "elementId": "pnr-41" }, { "remarkLines": { "remarkLine": { "text": "COMM ON FARE.    16.90                  COMM ON TAX.   0.00" } }, "index": 7, "id": 42, "type": "REG", "code": null, "elementId": "pnr-42" }, { "remarkLines": { "remarkLine": { "text": "INV NO. 17888401       ACCOUNT. BNE050532 PAYABLE. 1862.38" } }, "index": 8, "id": 43, "type": "REG", "code": null, "elementId": "pnr-43" }, { "remarkLines": { "remarkLine": { "text": "TKT NO. 176-5260225540 ISSUE. 13JUL22     AIRLINE. EK" } }, "index": 9, "id": 44, "type": "REG", "code": null, "elementId": "pnr-44" }, { "remarkLines": { "remarkLine": { "text": "PAX   . CAMPBELL/PENNY LEW MS" } }, "index": 10, "id": 45, "type": "REG", "code": null, "elementId": "pnr-45" }, { "remarkLines": { "remarkLine": { "text": "FARE  .        1690.00 TAXES.    189.28 SERVICE FEE.   0.00" } }, "index": 11, "id": 46, "type": "REG", "code": null, "elementId": "pnr-46" }, { "remarkLines": { "remarkLine": { "text": "COMM ON FARE.    16.90                  COMM ON TAX.   0.00" } }, "index": 12, "id": 47, "type": "REG", "code": null, "elementId": "pnr-47" }, { "remarkLines": { "remarkLine": { "text": "...END QUIKTRAVEL DATA...." } }, "index": 13, "id": 48, "type": "INVOICE", "code": null, "elementId": "pnr-48" }, { "remarkLines": { "remarkLine": { "text": "ID-NF" } }, "index": 14, "id": 55, "type": "CODED", "code": "Z", "elementId": "pnr-55" } ] }, "emailAddresses": { "emailAddress": { "address": "BOOKINGS@TRIPADEAL.COM.AU", "comment": "", "id": 54 } }, "accountingLines": { "accountingLine": [ { "fareApplication": "ONE", "formOfPaymentCode": "CA", "airlineDesignator": "EK", "documentNumber": "5260225539", "commissionAmount": 16.9, "baseFare": 1690, "taxAmount": 189.28, "passengerName": "HAYNES MARTIN WILLIAM MR", "numberOfConjunctedDocuments": 1, "numberOfCoupons": null, "originalTicketNumber": null, "tarriffBasis": "F", "pnrAccLineRecordId": "'+pal1.id+'", "status":true, "isExchanged": false, "id": 25, "index": 1, "elementId": "pnr-25" }, { "fareApplication": "ONE", "formOfPaymentCode": "CA", "airlineDesignator": "EK", "documentNumber": "5260225540", "commissionAmount": 16.9, "baseFare": 1690, "taxAmount": 189.28, "passengerName": "CAMPBELL PENNY LEW MS", "numberOfConjunctedDocuments": 1, "numberOfCoupons": null, "originalTicketNumber": null, "tarriffBasis": "F", "pnrAccLineRecordId":"'+pal.id+'", "status": true, "isExchanged": false, "id": 26, "index": 2, "elementId": "pnr-26" } ] }, "genericSpecialRequests": [ { "code": "ADTK", "freeText": "RITK/ADTKT BY 20JUL 1423 SYD LT", "airlineCode": "AA", "fullText": "ADTK AA  RITK/ADTKT BY 20JUL 1423 SYD LT", "id": 23, "type": "A", "msgType": "S" }, { "code": "APIN", "freeText": "200020518865", "airlineCode": "EY", "fullText": "EY APIN 200020518865", "id": 56, "type": "G", "msgType": "O" }, { "code": null, "freeText": "TRIPADEAL 135 777", "airlineCode": "YY", "fullText": "YY TRIPADEAL 135 777", "id": 57, "type": "G", "msgType": "O" } ], "profiles": { "profile": { "profileID": 181571956, "profileType": "AGY", "id": 58 } }, "numberInParty": 2, "numberOfInfants": 0, "numberInSegment": 2 }, "version": "1.19.0", "recordsUpdated": true, "segmentsUpdated": true, "accountingUpdated": true, "isManualSync": null, "reasonForManualSync": null }';
            req.requestBody=Blob.valueof(putData);
        RestContext.request = req;
        //req.params.put('appSessionCode',accc.app_session__c);
        // req.params.put('accountSFId',accc.id);
        // req.params.put('token','xyz');
        RestContext.response= res;
        Test.setMock(HttpCalloutMock.class, new PNRGetReservationApiTest());
        
        
        Test.startTest();
        PNRGetReIssueReservation.createPNRAccountingLineAndSegmentRecord();
        Test.stopTest();
    }  
    
}