<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>55.0</apiVersion>
    <decisions>
        <name>Check_Existing_Cs_attribution_for_city_surcharge</name>
        <label>Check Existing Cs attribution for city surcharge</label>
        <locationX>1028</locationX>
        <locationY>850</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>if_Existing_city_surcharge_exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetExistingCSAttribusionForCitySurcharge</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Creating_the_Negative_CS_Attribution_Records_in_On_Hold_State_0</targetReference>
            </connector>
            <label>if Existing city surcharge exist</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Negative_Cs_Attribution_Exist</name>
        <label>Check Negative Cs Attribution Exist</label>
        <locationX>312</locationX>
        <locationY>983</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>if_Existing_csAttribution</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetExistingCSAttribusion</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Creating_the_Negative_CS_Attribution_Records_in_On_Hold_State</targetReference>
            </connector>
            <label>if Existing csAttribution</label>
        </rules>
    </decisions>
    <decisions>
        <name>DepDateOrDepCityChanged</name>
        <label>DepDateOrDepCityChanged</label>
        <locationX>729</locationX>
        <locationY>389</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>If_Dep_Date_is_changes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.ordexp_departure_date__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record__Prior.ordexp_departure_date__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>NewOliGreaterThanOldOli</targetReference>
            </connector>
            <label>If Dep Date is changes</label>
        </rules>
        <rules>
            <name>If_Dep_City_is_changes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Departure_cities__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record__Prior.Departure_cities__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>NewOliGreaterThanOldOli_0</targetReference>
            </connector>
            <label>If Dep City is changes</label>
        </rules>
    </decisions>
    <decisions>
        <name>NewOliGreaterThanOldOli</name>
        <label>NewOliGreaterThanOldOli</label>
        <locationX>222</locationX>
        <locationY>624</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>checkGreaterThan</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.HSS_Amount__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <elementReference>$Record__Prior.HSS_Amount__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Creating_the_CS_Attribution_Records_in_On_Hold_State</targetReference>
            </connector>
            <label>checkGreaterThan</label>
        </rules>
        <rules>
            <name>checkLessThanOld</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.HSS_Amount__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>$Record__Prior.HSS_Amount__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetExistingCSAttribusion</targetReference>
            </connector>
            <label>checkLessThanOld</label>
        </rules>
    </decisions>
    <decisions>
        <name>NewOliGreaterThanOldOli_0</name>
        <label>NewOliGreaterThanOldOli</label>
        <locationX>1294</locationX>
        <locationY>579</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>When_Dep_City_Surcharge_Increse</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.ordexp_city_surcharge_amount__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <elementReference>$Record__Prior.ordexp_city_surcharge_amount__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Creating_the_CS_Attribution_Records_in_On_Hold_State_0</targetReference>
            </connector>
            <label>When Dep City Surcharge Increse</label>
        </rules>
        <rules>
            <name>When_Dep_City_Surcharge_Decrease</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.ordexp_city_surcharge_amount__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>$Record__Prior.ordexp_city_surcharge_amount__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetExistingCSAttribusionForCitySurcharge</targetReference>
            </connector>
            <label>When Dep City Surcharge Decrease</label>
        </rules>
    </decisions>
    <formulas>
        <name>CitySurchargeDecreased</name>
        <dataType>Currency</dataType>
        <expression>-({!$Record__Prior.ordexp_city_surcharge_amount__c} - {!$Record.ordexp_city_surcharge_amount__c})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>CitySurchargeIncreased</name>
        <dataType>Currency</dataType>
        <expression>{!$Record.ordexp_city_surcharge_amount__c} - {!$Record__Prior.ordexp_city_surcharge_amount__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>createdAfterSplitValue</name>
        <dataType>Boolean</dataType>
        <expression>{!$Record.isSplit__c}</expression>
    </formulas>
    <formulas>
        <name>SaleAmountForHssDecrease</name>
        <dataType>Currency</dataType>
        <expression>-({!$Record__Prior.HSS_Amount__c} - {!$Record.HSS_Amount__c})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>SaleAmountForhssIncrease</name>
        <dataType>Currency</dataType>
        <expression>{!$Record.HSS_Amount__c} - {!$Record__Prior.HSS_Amount__c}</expression>
        <scale>2</scale>
    </formulas>
    <interviewLabel>Creation of CS Attribution in On Hold state when Dep Date changes {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Creation of CS Attribution in On Hold state when Dep Date changes</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Creating_the_CS_Attribution_Records_in_On_Hold_State</name>
        <label>Creating the CS Attribution Records in On Hold State</label>
        <locationX>121</locationX>
        <locationY>834</locationY>
        <inputAssignments>
            <field>CurrencyIsoCode</field>
            <value>
                <elementReference>$Record.CurrencyIsoCode</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TAD_Order__c</field>
            <value>
                <elementReference>$Record.ordexp_TAD_Order__r.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>User__c</field>
            <value>
                <elementReference>$Record.DepDateLastModifiedby__r.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>createdAfterSpilit__c</field>
            <value>
                <elementReference>createdAfterSplitValue</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_Attribution_Type__c</field>
            <value>
                <stringValue>Dep Date HSS</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_OLI__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_Sale_Amount__c</field>
            <value>
                <elementReference>SaleAmountForhssIncrease</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_status__c</field>
            <value>
                <stringValue>On Hold</stringValue>
            </value>
        </inputAssignments>
        <object>CS_Attribution_POE__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Creating_the_CS_Attribution_Records_in_On_Hold_State_0</name>
        <label>Creating the CS Attribution Records in On Hold State</label>
        <locationX>1576</locationX>
        <locationY>742</locationY>
        <inputAssignments>
            <field>CurrencyIsoCode</field>
            <value>
                <elementReference>$Record.CurrencyIsoCode</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TAD_Order__c</field>
            <value>
                <elementReference>$Record.ordexp_TAD_Order__r.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>User__c</field>
            <value>
                <elementReference>$Record.DepCityLastModifiedBy__r.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>createdAfterSpilit__c</field>
            <value>
                <elementReference>createdAfterSplitValue</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_Attribution_Type__c</field>
            <value>
                <stringValue>Dep City Surcharge</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_OLI__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_Sale_Amount__c</field>
            <value>
                <elementReference>CitySurchargeIncreased</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_status__c</field>
            <value>
                <stringValue>On Hold</stringValue>
            </value>
        </inputAssignments>
        <object>CS_Attribution_POE__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Creating_the_Negative_CS_Attribution_Records_in_On_Hold_State</name>
        <label>Creating the Negative CS Attribution Records in On Hold State</label>
        <locationX>515</locationX>
        <locationY>980</locationY>
        <inputAssignments>
            <field>CurrencyIsoCode</field>
            <value>
                <elementReference>$Record.CurrencyIsoCode</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TAD_Order__c</field>
            <value>
                <elementReference>$Record.ordexp_TAD_Order__r.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>User__c</field>
            <value>
                <elementReference>GetExistingCSAttribusion.User__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>createdAfterSpilit__c</field>
            <value>
                <elementReference>createdAfterSplitValue</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_Attribution_Type__c</field>
            <value>
                <stringValue>Dep Date HSS</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_OLI__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_Sale_Amount__c</field>
            <value>
                <elementReference>SaleAmountForHssDecrease</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_attribution__c</field>
            <value>
                <elementReference>GetExistingCSAttribusion.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_status__c</field>
            <value>
                <stringValue>Cancelled</stringValue>
            </value>
        </inputAssignments>
        <object>CS_Attribution_POE__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Creating_the_Negative_CS_Attribution_Records_in_On_Hold_State_0</name>
        <label>Creating the Negative CS Attribution Records in On Hold State</label>
        <locationX>1191</locationX>
        <locationY>939</locationY>
        <inputAssignments>
            <field>CurrencyIsoCode</field>
            <value>
                <elementReference>$Record.CurrencyIsoCode</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TAD_Order__c</field>
            <value>
                <elementReference>$Record.ordexp_TAD_Order__r.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>User__c</field>
            <value>
                <elementReference>GetExistingCSAttribusionForCitySurcharge.User__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>createdAfterSpilit__c</field>
            <value>
                <elementReference>createdAfterSplitValue</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_Attribution_Type__c</field>
            <value>
                <stringValue>Dep City Surcharge</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_OLI__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_Sale_Amount__c</field>
            <value>
                <elementReference>CitySurchargeDecreased</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_attribution__c</field>
            <value>
                <elementReference>GetExistingCSAttribusionForCitySurcharge.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>cs_status__c</field>
            <value>
                <stringValue>Cancelled</stringValue>
            </value>
        </inputAssignments>
        <object>CS_Attribution_POE__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <name>GetExistingCSAttribusion</name>
        <label>GetExistingCSAttribusion</label>
        <locationX>327</locationX>
        <locationY>825</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_Negative_Cs_Attribution_Exist</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>cs_attribution__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </filters>
        <filters>
            <field>cs_Attribution_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Dep Date HSS</stringValue>
            </value>
        </filters>
        <filters>
            <field>cs_OLI__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>TAD_Order__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.ordexp_TAD_Order__r.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>CS_Attribution_POE__c</object>
        <sortField>LastModifiedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetExistingCSAttribusionForCitySurcharge</name>
        <label>GetExistingCSAttribusionForCitySurcharge</label>
        <locationX>1187</locationX>
        <locationY>734</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_Existing_Cs_attribution_for_city_surcharge</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>cs_attribution__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </filters>
        <filters>
            <field>cs_Attribution_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Dep City Surcharge</stringValue>
            </value>
        </filters>
        <filters>
            <field>cs_OLI__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>TAD_Order__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.ordexp_TAD_Order__r.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>CS_Attribution_POE__c</object>
        <sortField>LastModifiedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>410</locationX>
        <locationY>48</locationY>
        <connector>
            <targetReference>DepDateOrDepCityChanged</targetReference>
        </connector>
        <filterLogic>1 OR 2</filterLogic>
        <filters>
            <field>ordexp_departure_date__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Departure_cities__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>order_line_item__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
